<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Java-Annotation(95%)Java中注解可以说是Java编程的一大特性，本章节主要内容：  如何定义一个注解：包括元注解、重复注解等的定义方式和标记方式 注解标记的位置：注解能够标记在哪个地方 JDK内置注解：包括java.lang、java.lang.annotation、javax.annotation包中的非元注解的使用 注解处理器：注解的定义一般有三种级别，对应三类的注解处理">
<meta property="og:type" content="article">
<meta property="og:title" content="Java Annotation">
<meta property="og:url" content="http://example.com/2024/04/17/Java/Java%20Annotation/index.html">
<meta property="og:site_name" content="Askia&#39;s Zoom">
<meta property="og:description" content="Java-Annotation(95%)Java中注解可以说是Java编程的一大特性，本章节主要内容：  如何定义一个注解：包括元注解、重复注解等的定义方式和标记方式 注解标记的位置：注解能够标记在哪个地方 JDK内置注解：包括java.lang、java.lang.annotation、javax.annotation包中的非元注解的使用 注解处理器：注解的定义一般有三种级别，对应三类的注解处理">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230902163526667.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230902164439760.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230902182112622.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230902182544963.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230904173434895.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230904175630852.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20231217224830464.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20231217223554656.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230904190541973.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230904190416564.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230904184612017.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205102954474.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205104204522.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205114800460.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205115005156.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205142802476.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205143827876.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205143925642.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205145412555.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205145537976.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205145632617.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205145735420.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205145902523.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205150215756.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205150247735.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205150325941.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205150412867.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205150651903.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205151552597.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20240205151811017.png">
<meta property="og:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230907195235350.png">
<meta property="article:published_time" content="2024-04-16T16:03:58.000Z">
<meta property="article:modified_time" content="2024-04-16T16:22:07.178Z">
<meta property="article:author" content="Askia">
<meta property="article:tag" content="core java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/04/17/Java/Java%20Annotation/image-20230902163526667.png">


<link rel="canonical" href="http://example.com/2024/04/17/Java/Java%20Annotation/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2024/04/17/Java/Java%20Annotation/","path":"2024/04/17/Java/Java Annotation/","title":"Java Annotation"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Java Annotation | Askia's Zoom</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Askia's Zoom</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">just keep going!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-schedule"><a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a></li><li class="menu-item menu-item-posts"><a href="/yposts/" rel="section"><i class="fa fa-paw fa-fw"></i>古诗词</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Java-Annotation-95"><span class="nav-number">1.</span> <span class="nav-text">Java-Annotation(95%)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">1.1.</span> <span class="nav-text">注解的定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E6%A0%87%E8%AE%B0%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.2.</span> <span class="nav-text">注解标记的位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E6%A0%87%E5%87%86%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.3.</span> <span class="nav-text">内置标准注解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AF%E7%BB%A7%E6%89%BF%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.3.1.</span> <span class="nav-text">可继承的注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AF%E9%87%8D%E5%A4%8D%E6%A0%87%E8%AE%B0%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.3.2.</span> <span class="nav-text">可重复标记的注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.3.3.</span> <span class="nav-text">文档注解</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F"><span class="nav-number">1.3.4.</span> <span class="nav-text">本地变量</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%87%8D%E5%86%99%E6%96%B9%E6%B3%95"><span class="nav-number">1.3.5.</span> <span class="nav-text">重写方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%9F%E5%BC%83%E6%96%B9%E6%B3%95"><span class="nav-number">1.3.6.</span> <span class="nav-text">废弃方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%BC%8F%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.3.7.</span> <span class="nav-text">函数式接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%89%E5%85%A8%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0"><span class="nav-number">1.3.8.</span> <span class="nav-text">安全可变参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AD%A6%E5%91%8A%E6%8A%91%E5%88%B6"><span class="nav-number">1.3.9.</span> <span class="nav-text">警告抑制</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">1.4.</span> <span class="nav-text">注解处理器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RUNTIME%E7%BA%A7%E5%88%AB%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86"><span class="nav-number">1.4.1.</span> <span class="nav-text">RUNTIME级别注解处理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SOURCE%E7%BA%A7%E5%88%AB%E7%9A%84%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86"><span class="nav-number">1.4.2.</span> <span class="nav-text">SOURCE级别的注解处理</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C"><span class="nav-number">1.4.2.1.</span> <span class="nav-text">基于命令行编译运行</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E7%BC%96%E8%AF%91%E8%BF%90%E8%A1%8C"><span class="nav-number">1.4.2.2.</span> <span class="nav-text">基于服务注册编译运行</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8EMaven%E7%BC%96%E8%AF%91%E6%8F%92%E4%BB%B6%E4%B8%AD%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8%E5%8F%82%E6%95%B0%E8%BF%90%E8%A1%8C"><span class="nav-number">1.4.2.3.</span> <span class="nav-text">基于Maven编译插件中注解处理器参数运行</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CLASS%E7%BA%A7%E5%88%AB%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86"><span class="nav-number">1.4.3.</span> <span class="nav-text">CLASS级别注解处理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E6%BA%90%E7%A0%81%E7%BB%93%E6%9E%84"><span class="nav-number">1.5.</span> <span class="nav-text">注解源码结构</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AF%E9%87%8D%E5%A4%8D%E6%A0%87%E8%AE%B0%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.5.1.</span> <span class="nav-text">可重复标记注解的实现</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E8%A7%A3%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6"><span class="nav-number">1.6.</span> <span class="nav-text">注解应用框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Lombok"><span class="nav-number">1.6.1.</span> <span class="nav-text">Lombok</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%BB%E5%8C%85%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">主包注解</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#val-amp-amp-var"><span class="nav-number">1.6.1.1.1.</span> <span class="nav-text">val&amp;&amp;var</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Data%E5%8F%8A%E7%9B%B8%E5%85%B3%E7%9A%84%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.6.1.1.2.</span> <span class="nav-text">@Data及相关的注解</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Builder%E5%92%8C-Singular"><span class="nav-number">1.6.1.1.3.</span> <span class="nav-text">@Builder和@Singular</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Cleanup"><span class="nav-number">1.6.1.1.4.</span> <span class="nav-text">@Cleanup</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#NonNull"><span class="nav-number">1.6.1.1.5.</span> <span class="nav-text">@NonNull</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#SneakyThrows"><span class="nav-number">1.6.1.1.6.</span> <span class="nav-text">@SneakyThrows</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Synchronized"><span class="nav-number">1.6.1.1.7.</span> <span class="nav-text">@Synchronized</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Value"><span class="nav-number">1.6.1.1.8.</span> <span class="nav-text">@Value</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#With"><span class="nav-number">1.6.1.1.9.</span> <span class="nav-text">@With</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E5%8C%85%E6%B3%A8%E8%A7%A3%EF%BC%88%E6%97%A5%E5%BF%97%EF%BC%89"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">扩展包注解（日志）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E9%AA%8C%E5%8C%85%E6%B3%A8%E8%A7%A3"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">实验包注解</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Jcommander"><span class="nav-number">1.6.2.</span> <span class="nav-text">Jcommander</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E7%94%A8%E6%96%87%E7%AB%A0%E5%8F%82%E8%80%83"><span class="nav-number">2.</span> <span class="nav-text">引用文章参考</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JDK-11"><span class="nav-number">3.</span> <span class="nav-text">JDK 11</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Deprecated"><span class="nav-number">3.1.</span> <span class="nav-text">@Deprecated</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Askia"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">Askia</p>
  <div class="site-description" itemprop="description">And you! my friend, a true hero!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">41</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/04/17/Java/Java%20Annotation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Askia">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Askia's Zoom">
      <meta itemprop="description" content="And you! my friend, a true hero!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Java Annotation | Askia's Zoom">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Java Annotation
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2024-04-17 00:03:58 / 修改时间：00:22:07" itemprop="dateCreated datePublished" datetime="2024-04-17T00:03:58+08:00">2024-04-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="Java Annotation" href="/2024/04/17/Java/Java%20Annotation/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::2585bb142a5ec6493bdc16c1463c52a1" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h2 id="Java-Annotation-95"><a href="#Java-Annotation-95" class="headerlink" title="Java-Annotation(95%)"></a>Java-Annotation(95%)</h2><p><code>Java</code>中注解可以说是<code>Java</code>编程的一大特性，本章节主要内容：</p>
<ol>
<li>如何定义一个注解：包括元注解、重复注解等的定义方式和标记方式</li>
<li>注解标记的位置：注解能够标记在哪个地方</li>
<li><code>JDK</code>内置注解：包括<code>java.lang</code>、<code>java.lang.annotation</code>、<code>javax.annotation</code>包中的非元注解的使用</li>
<li>注解处理器：注解的定义一般有三种级别，对应三类的注解处理器，将会一一介绍！</li>
<li>注解的结构：该小节会反编译注解的字节码，从底层来查看一个注解的源代码</li>
<li>注解应用框架：会介绍常见的注解驱动框架的基本使用，如<code>core java</code>中介绍到的<a href="jcommander.org">Jcommander</a>、大名鼎鼎的<a target="_blank" rel="noopener" href="https://projectlombok.org/">Lombok</a></li>
</ol>
<p>剩余</p>
<ul>
<li>CLASS级别注解处理</li>
</ul>
<span id="more"></span>
<h3 id="注解的定义"><a href="#注解的定义" class="headerlink" title="注解的定义"></a>注解的定义</h3><p>首先要知道注解在<code>Java</code>代码中并不起任何实际的作用，他的唯一作用只有标记，标记该对象具备某个性质，在<code>java</code>中所有带<code>@</code>开头的都是注解，如常见的<code>@Override</code>，标记<code>@Override</code>代表该方法是一个重写方法！</p>
<p>定义注解的方式很像定义接口，其格式如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Common &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>interface</code>前面加上<code>@</code>定义出来的就是注解，<code>idea</code>提供了快速定义的方式，你可以通过<code>new --&gt; new java class</code>，选中<code>Annotation</code>，就可以创建一个注解：</p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20230902163526667.png" alt="image-20230902163526667"></p>
<p>回到<code>@Override</code>注解，你可以在任何重写方法上标记<code>@Override</code>，但如果你把注解标记在字段上，则<code>IDE</code>会报错！这是因为<code>@Override</code>注解的标记是有范围限定的！他只能标记在方法上，我们查看<code>@Override</code>的源代码：</p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20230902164439760.png" alt="image-20230902164439760"></p>
<p>发现其上有两个注解<code>@Target</code>、<code>@Retention</code>，这两个注解就是用于规定<code>@Override</code>作用范围和存储级别，这种规定注解接口的作用范围和行为属性的注解一般被称之为元注解（即用来定义注解的注解），<code>JDK</code>中的元注解有<code>5</code>个：</p>
<ul>
<li><p><code>@Target</code>：表示该注解能标记在哪个地方，可以传递多个<code>ElementType</code>的枚举值，其枚举量如下：</p>
<ul>
<li><p><code>TYPE</code>：标记在类型上，如类、接口、枚举类</p>
</li>
<li><p><code>FIELD</code>：标记在字段上，如类或接口的字段或常量字段、枚举量</p>
</li>
<li><p><code>METHOD</code>：标记在方法上，包括静态或非静态</p>
</li>
<li><p><code>PARAMETER</code>：标记在方法参数上</p>
</li>
<li><p><code>CONSTRUCTOR</code>：标记在构造器上</p>
</li>
<li><p><code>LOCAL_VARIABLE</code>：标记在局部变量上</p>
</li>
<li><p><code>ANNOTATION_TYPE</code>：标记在注解的定义上，元注解一般都是这个级别</p>
</li>
<li><p><code>PACKAGE</code>：标记在包上，一般和<code>package-info.java</code>有关</p>
</li>
<li><p><code>TYPE_PARAMETER</code>（<code>JDK 1.8</code>）：标记在泛型类型参数上，如<code>T</code>，这里举个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE_PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Common &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span>&lt;@<span class="title">Common</span> <span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Class&lt;<span class="meta">@Common</span> ?&gt; clazz;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>TYPE_USE</code>（<code>JDK 1.8</code>）：标记在所有使用的类型上（只要是类型就行），如抛出的异常、继承时的类名、泛型的<code>?</code>等，这里举个例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE_PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Common &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> <span class="keyword">extends</span> @<span class="title">Common</span> <span class="title">Number</span> <span class="title">implement</span> @<span class="title">Common</span> <span class="title">Closable</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Class&lt;<span class="meta">@Common</span> ?&gt; getClass() <span class="keyword">throws</span> <span class="meta">@Common</span> IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>Retention</code>：表示该注解的存储级别，有三个值，只能填其一</p>
<ul>
<li><code>SOURCE</code>：源码级别，该注解在编译成字节码的时候会被去掉，类似于注释的处理！</li>
<li><code>CLASS</code>：字节码级别，该注解在编译成字节码的时候会被保留，但不会被<code>JVM</code>加载，在处理字节码的时候能获取，但无法被反射<code>API</code>获取！</li>
<li><code>RUNTIME</code>：运行级别，该注解在编译成字节码的时候会被保留，并且会被<code>JVM</code>加载，可以通过反射来获取<code>API</code></li>
</ul>
</li>
<li><p><code>Documented</code>：指明该注解是否会被<code>Javadoc</code>记录</p>
</li>
<li><p><code>Inherited</code>：指定注解是否能够被继承，标记了该元注解的注解标记在父类的代码上时，子类也能够获取！</p>
</li>
<li><p><code>Repeatable</code>（<code>JDK 8</code>）：表示注解是否可重复标记！</p>
</li>
</ul>
<p>这<code>5</code>大元注解中，其中<code>Target</code>和<code>Retention</code>是必须的，其他都是可选的，根据实际情况标记即可，因此完整创建一个注解需要如下的模板：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE_PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Common &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到此，注解的声明方式介绍完毕，那么注解内部的定义呢？正如类内部可以定义字段、方法一样，注解内部也可以定义一些字段，用来标记一些信息，注解内部允许定义下面的数据：</p>
<ul>
<li>基本类型（<code>int</code>、<code>short</code>、<code>long</code>、<code>byte</code>、<code>char</code>、<code>double</code>、<code>float</code>和<code>boolean</code>）</li>
<li><code>String</code></li>
<li><code>Class</code>，如：<code>Class&lt;?&gt;</code>、<code>Class&lt;Integer&gt;</code></li>
<li><code>Enum</code>类型</li>
<li>注解类型</li>
<li>上面这些类型的数组，如<code>Class&lt;?&gt;[]</code> <code>String[]</code></li>
</ul>
<p>我们仍然能在注解内部定义内部类、内部接口等，注解声明实际上是当作接口看的，在：</p>
<blockquote>
<p>src/main/java/cn/argento/askia/annotation/full/BugReport.java</p>
</blockquote>
<p>中你可以看到一个注解能够定义的所有定义方式和内容，该<code>Demo</code>参考<code>Core Java 11</code>编写！</p>
<p>值得注意的一点是：</p>
<ul>
<li>在注解中定义内部类、内部枚举类、内部注解、内部接口等，默认都是<code>public</code>并且不允许使用其他的修饰级别如<code>private</code>、<code>protected</code>，这点也和接口一摸一样！</li>
</ul>
<p>注解数据的定义也很简单，只需要在定义数据变量加上括号即可，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE_PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Common &#123;</span><br><span class="line">	<span class="function">String <span class="title">version</span><span class="params">()</span></span>;</span><br><span class="line">	Class&lt;?&gt; testClazz();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果希望数据成员有默认值，则可以使用<code>default</code>，但是注意，注解成员不允许有<code>null</code>值，可以使用<code>Void.class</code>、<code>&quot;&quot;</code>、<code>-1</code>、<code>&#123;&#125;</code>等作为代替！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE_PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Common &#123;</span><br><span class="line">	<span class="function">String <span class="title">version</span><span class="params">()</span> <span class="keyword">default</span> &quot;1.5.1&quot;</span>;</span><br><span class="line">	Class&lt;?&gt; testClazz() <span class="keyword">default</span> Void.class;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么在标记注解的时候如何提供数据呢？假如这里有一个注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE_PARAMETER, ElementType.TYPE_USE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Common &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;1.5.1&quot;</span>;</span><br><span class="line">	<span class="function">String <span class="title">version</span><span class="params">()</span> <span class="keyword">default</span> &quot;1.5.1&quot;</span>;</span><br><span class="line">	Class&lt;?&gt; testClazz() <span class="keyword">default</span> Void.class;</span><br><span class="line">    <span class="keyword">int</span>[] ip <span class="keyword">default</span> &#123;<span class="number">192</span>, <span class="number">168</span>, <span class="number">0</span>, <span class="number">1</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个注解包含了四个数据成员，其中一个是数组。提供数据的时候需要写出具体要提供的项等于值的格式，提供多个项使用逗号分隔：</p>
<p><strong>提供数据给注解无需全部提供，只提供需要的即可，其他都会使用默认值，如</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> @<span class="title">Common</span>(<span class="title">version</span> </span>= <span class="string">&quot;1.0.3&quot;</span>, testClazz = Main.class) Main &#123;</span><br><span class="line">    <span class="comment">// Common注解内各个成员的值：</span></span><br><span class="line">    <span class="comment">// value = &quot;1.5.1&quot;</span></span><br><span class="line">    <span class="comment">// version = &quot;1.0.3&quot;</span></span><br><span class="line">    <span class="comment">// testClazz = Main.class</span></span><br><span class="line">    <span class="comment">// ip = &#123;192, 168, 0, 1&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果注解中定义了一个特殊的数值成员<code>value</code>，并且当你只需要给这个<code>value</code>提供值的时候，可以不写项名：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> @<span class="title">Common</span>(&quot;1.0.3&quot;) <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Common注解内各个成员的值：</span></span><br><span class="line">    <span class="comment">// value = &quot;1.0.3&quot;</span></span><br><span class="line">    <span class="comment">// version = &quot;1.5.1&quot;</span></span><br><span class="line">    <span class="comment">// testClazz = Void.class</span></span><br><span class="line">    <span class="comment">// ip = &#123;192, 168, 0, 1&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果提供的注解数值成员是一个数组，则提供内容的时候需要使用<code>&#123;&#125;</code>,但是当提供的数组数据只有一个成员的时候，括号可以省略：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> @<span class="title">Common</span>(<span class="title">ip</span> </span>= &#123;<span class="number">192</span>, <span class="number">168</span>, <span class="number">0</span>, <span class="number">3</span>&#125;) Main &#123;</span><br><span class="line">    <span class="comment">// Common注解内各个成员的值：</span></span><br><span class="line">    <span class="comment">// value = &quot;1.5.1&quot;</span></span><br><span class="line">    <span class="comment">// version = &quot;1.5.1&quot;</span></span><br><span class="line">    <span class="comment">// testClazz = Void.class</span></span><br><span class="line">    <span class="comment">// ip = &#123;192, 168, 0, 3&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数组数据只有一个成员</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> @<span class="title">Common</span>(<span class="title">ip</span> </span>= <span class="number">192</span>) Main &#123;</span><br><span class="line">    <span class="comment">// Common注解内各个成员的值：</span></span><br><span class="line">    <span class="comment">// value = &quot;1.5.1&quot;</span></span><br><span class="line">    <span class="comment">// version = &quot;1.5.1&quot;</span></span><br><span class="line">    <span class="comment">// testClazz = Void.class</span></span><br><span class="line">    <span class="comment">// ip = &#123;192&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果只标注注解而不提供任何成员数据时，所有的数据都会使用默认值，这个时候注解无需加括号：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组数据只有一个成员</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> @<span class="title">Common</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Common注解内各个成员的值：</span></span><br><span class="line">    <span class="comment">// value = &quot;1.5.1&quot;</span></span><br><span class="line">    <span class="comment">// version = &quot;1.5.1&quot;</span></span><br><span class="line">    <span class="comment">// testClazz = Void.class</span></span><br><span class="line">    <span class="comment">// ip = &#123;192, 168, 0, 1&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="注解标记的位置"><a href="#注解标记的位置" class="headerlink" title="注解标记的位置"></a>注解标记的位置</h3><p><code>@Target</code>元注解中共定义了<code>10</code>处位置给注解标记，关键的问题就是如何标记，或者说标记在哪里才算合法？</p>
<blockquote>
<p>TYPE类型</p>
</blockquote>
<p><code>Type</code>类型允许你将注解标记在类、接口、枚举类上，需要将注解放置在<code>class</code>、<code>interface</code>、<code>enum</code>前面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Common</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Common</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Common</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>FIELD类型</p>
</blockquote>
<p>如果是字段（包括常量）类型，则需要标记在类型前面，枚举值则在枚举值前标记</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">C</span></span>&#123;</span><br><span class="line">    <span class="meta">@Common</span> A, <span class="meta">@Common</span> B</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 三种方式皆可！</span></span><br><span class="line">	<span class="meta">@Common</span></span><br><span class="line">	<span class="keyword">private</span> A name;</span><br><span class="line">	<span class="meta">@Common</span> <span class="keyword">private</span> A name;</span><br><span class="line">    <span class="keyword">private</span> <span class="meta">@Common</span> A name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">    <span class="meta">@Common</span></span><br><span class="line">    String c = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>METHOD类型</p>
</blockquote>
<p>标记在方法上即可，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">   <span class="meta">@Common</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PARAMETER类型</p>
</blockquote>
<p>标记在方法的参数上即可，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Main</span></span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">(<span class="meta">@Common</span> String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>CONSTRUCTOR类型</p>
</blockquote>
<p>标记在构造器上即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Common</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Main</span><span class="params">()</span></span>&#123;</span><br><span class="line">   </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ANNOTATION_TYPE类型</p>
</blockquote>
<p>标记在注解定义上，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Common</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Main&#123;</span><br><span class="line">   <span class="function"><span class="keyword">int</span> <span class="title">version</span><span class="params">()</span> <span class="keyword">default</span> 2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>LOCAL_VARIABLE类型</p>
</blockquote>
<p>标记在局部变量上，注意定义该类型的注解，其源码级别只能是<code>SOURCE</code>级别</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span></span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Main</span><span class="params">()</span></span>&#123; </span><br><span class="line">     <span class="meta">@Common</span> String a = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PACKAGE</p>
</blockquote>
<p>标记在<code>package-info.java</code>里面的<code>package</code>上，如：注意定义该类型的注解，其源码级别只能是<code>SOURCE</code>级别</p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20230902182112622.png" alt="image-20230902182112622"></p>
<p>参考写法：<code>src/main/java/cn/argento/askia/annotation/full/package-info.java</code></p>
<blockquote>
<p>TYPE_PARAMETER</p>
</blockquote>
<p>定义在所有类型参数变量的位置上，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span>&lt;@<span class="title">Common</span> <span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">	<span class="keyword">public</span> &lt;<span class="meta">@Common</span> S&gt; <span class="function">S <span class="title">getType</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TYPE_USE</p>
</blockquote>
<p>定义在所有使用类型上，只要是单独的类型都可，如：<code>List&lt;@Common String&gt;</code>、<code>public void test() throws @Common IOException</code>、<code>public class Main extends @Common Main2</code>，该方式的定义位置非常多样，这里引用<code>core java</code>的结论：</p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20230902182544963.png" alt="image-20230902182544963"></p>
<h3 id="内置标准注解"><a href="#内置标准注解" class="headerlink" title="内置标准注解"></a>内置标准注解</h3><p>在<code>java.lang</code>、<code>java.lang.annotation</code>、<code>javax.annotation</code>中，有非常多标准注解！</p>
<p><code>java.lang</code>包：<code>@Deprecated</code>、<code>@FunctionalInterface</code>、<code>@Override</code>、<code>@SafeVarargs</code>、<code>@SuppressWarnings</code></p>
<p><code>java.lang.annotation</code>包（元注解包）：<code>@Documented</code>、<code>@Inherited</code>、<code>@Native</code>、<code>@Repeatable</code>、<code>@Retention</code>、<code>@Target</code></p>
<p><code>javax.annotation</code>包：<code>@Generated</code>、<code>@PostConstruct</code>、<code>@PreDestroy</code>、<code>@Resource</code>等</p>
<p>其中<code>javax.annotation</code>包是扩展的标准化注解包，其中包括了<code>jsr</code>标准规定的一些注解，该包中的注解并不是重点，这些注解你将在<code>Spring</code>框架中遇到</p>
<p><code>@Retention</code>和<code>@Target</code>我们已介绍过，则无需再花篇幅！</p>
<h4 id="可继承的注解"><a href="#可继承的注解" class="headerlink" title="可继承的注解"></a>可继承的注解</h4><p>标记了<code>@Inherited</code>元注解的注解标记在类上的时候可以在子类中被获取，我们定义一个注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> InheritedAnnotation &#123;</span><br><span class="line">    <span class="function">String <span class="title">version</span><span class="params">()</span> <span class="keyword">default</span> &quot;1.0&quot;</span>;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;askia&quot;</span>;</span><br><span class="line">    Class&lt;?&gt; clazz() <span class="keyword">default</span> Void.class;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意这种带<code>@Inherited</code>的注解只有标记在类上的时候才有继承性，如果标记在方法上或者标记在接口上或其他位置，则无法实现注解继承！</p>
<p>定义一个<code>Father</code>类和<code>FatherInterface</code>接口，在<code>Father</code>类和<code>FatherInterface</code>接口上标记<code>@InheritedAnnotation</code>注解，在<code>Father</code>类上的某个方法上标记<code>@InheritedAnnotation</code>注解，然后让<code>Son</code>类继承<code>Father</code>类，<code>Son2</code>类实现<code>FatherInterface</code>，进行测试！</p>
<blockquote>
<p>InheritedAnnotation.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> InheritedAnnotation &#123;</span><br><span class="line">    <span class="function">String <span class="title">version</span><span class="params">()</span> <span class="keyword">default</span> &quot;1.0&quot;</span>;</span><br><span class="line">    <span class="function">String <span class="title">name</span><span class="params">()</span> <span class="keyword">default</span> &quot;askia&quot;</span>;</span><br><span class="line">    Class&lt;?&gt; clazz() <span class="keyword">default</span> Void.class;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Father.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@InheritedAnnotation(name = &quot;Askia3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Father</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Father</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = <span class="string">&quot;Askia&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Father</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InheritedAnnotation(name = &quot;Askia2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@InheritedAnnotation(name = &quot;Askia2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Father <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>FatherInterface.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@InheritedAnnotation</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FatherInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Son.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Father</span> <span class="keyword">implements</span> <span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">Son</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getName() + <span class="string">&quot; = &quot;</span> + LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Son o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Son2.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Son2</span> <span class="keyword">implements</span> <span class="title">FatherInterface</span></span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在反射<code>API</code>中，获取<code>Runtime</code>级别的注解可以通过<code>getAnnotations()</code>和<code>getDeclaredAnnotations()</code>获取，他们的区别是<code>getDeclaredAnnotations()</code>不会获取继承性的注解！</p>
<blockquote>
<p>测试代码</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InheritedTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException </span>&#123;</span><br><span class="line">        <span class="comment">// 方法上不会被继承</span></span><br><span class="line">        <span class="comment">// 结果：[]</span></span><br><span class="line">        <span class="keyword">final</span> Method getName = Son.class.getMethod(<span class="string">&quot;getName&quot;</span>);</span><br><span class="line">        <span class="keyword">final</span> Annotation[] annotations = getName.getAnnotations();</span><br><span class="line">        System.out.println(Arrays.toString(annotations));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 子类被继承 Son类继承Father类，Father类上标记有@InheritedAnnotation注解！</span></span><br><span class="line">        <span class="comment">// 结果：[@cn.argento.askia.annotation.inherited.InheritedAnnotation(name=Askia3, clazz=class java.lang.Void, version=1.0)]</span></span><br><span class="line">        <span class="keyword">final</span> Annotation[] annotations1 = Son.class.getAnnotations();</span><br><span class="line">        System.out.println(Arrays.toString(annotations1));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// DeclaredAnnotations获取直接注解！</span></span><br><span class="line">        <span class="comment">// 结果：[]</span></span><br><span class="line">        <span class="keyword">final</span> Annotation[] annotations12 = Son.class.getDeclaredAnnotations();</span><br><span class="line">        System.out.println(Arrays.toString(annotations12));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 接口上也不会被继承</span></span><br><span class="line">        <span class="comment">// 结果: []</span></span><br><span class="line">        <span class="keyword">final</span> Annotation[] annotations2 = Son2.class.getAnnotations();</span><br><span class="line">        System.out.println(Arrays.toString(annotations2));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果只有标记在<code>Father</code>类上的注解能够被反射<code>API</code>获取，其他的都无法获取！具体可以参考<code>Demo</code>：</p>
<blockquote>
<p>src/main/java/cn/argento/askia/annotation/inherited/InheritedTest.java</p>
</blockquote>
<p>另外继承性可以多级继承，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@interface</span> Anno&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Anno</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> <span class="keyword">extends</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 可以获取</span></span><br><span class="line">        <span class="keyword">final</span> Anno annotation = C.class.getAnnotation(Anno.class);</span><br><span class="line">        System.out.println(annotation);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>实际上方法上、字段上也能获取类似于继承性质的注解，如果子类继承了父类，但是却没有重写父类的某个方法，则通过子类的Class对象获取该方法时（注意，<code>getMethod()</code>的核心有两：1.只能获取public，2.获取Class对象对应的类及其所有父类）可以获取，如上面的Father类中的setName()，该方法由于是public的，且Son类没有重写，所以通过Son.class.getMethod(“setName”, String.class).getAnnotations()可以获取到@InheritedAnnotation。同样的，字段、接口中的常量和方法、接口中的默认方法也适用这个规则！</p>
</blockquote>
<h4 id="可重复标记的注解"><a href="#可重复标记的注解" class="headerlink" title="可重复标记的注解"></a>可重复标记的注解</h4><p><code>@Repeatable</code>源代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.ANNOTATION_TYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Repeatable &#123;</span><br><span class="line">    Class&lt;? extends Annotation&gt; value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>标记了<code>@Repeatable</code>的元注解的注解支持重复标记在类、方法等上面。我们先定义一个注解，并将其变成可重复标记的注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RepeatableAnnotation &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">description</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Repeatable</code>需要一个装载重复注解的容器，这个容器一般也是一个注解。为了区分，其命名一般是可重复注解的名称加上<code>s</code>。</p>
<p>另外这个容器注解的定义有下面的要求：</p>
<ol>
<li><code>@Target</code>必须是可重复标记注解的全集或者子集</li>
<li><code>@Retention</code>必须和可重复标记注解相同</li>
<li>必须要定义<code>value()</code>数据成员来装载可重复注解，并且<code>value()</code>数据成员的类型是可重复标记注解的数组类型！</li>
<li>可重复的注解标记了<code>@Documented</code>，则注解容器也要标记<code>@Documented</code></li>
</ol>
<p>我们现在根据上面的<code>4</code>个要求来定义这个容器注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据第一条规则，这里必须是RepeatableAnnotation的@Target的全集或者子集，如下面的结果都是合法的</span></span><br><span class="line"><span class="comment">// &#123;ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.TYPE&#125;</span></span><br><span class="line"><span class="comment">// &#123;ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.TYPE&#125;</span></span><br><span class="line"><span class="comment">// &#123;ElementType.FIELD, ElementType.METHOD, ElementType.TYPE&#125;</span></span><br><span class="line"><span class="comment">// &#123;ElementType.FIELD, ElementType.TYPE&#125;</span></span><br><span class="line"><span class="comment">// .....</span></span><br><span class="line"><span class="comment">// 但是注意，只有这里的target的位置才能实现重复标记，如下面的&#123;ElementType.FIELD、, ElementType.CONSTRUCTOR, ElementType.METHOD&#125;，则只能在FIELD、CONSTRUCTOR、METHOD才能重复标记，在TYPE上无法重复标记！</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="comment">// 根据第二条规则，这里要和RepeatableAnnotation保持一致</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">// 根据第四条规定，因为@RepeatableAnnotation有@Documented，则其容器注解也要有</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="comment">// 容器注解的命名规则是可重复标记注解的名称 + s</span></span><br><span class="line"><span class="meta">@interface</span> RepeatableAnnotations&#123;</span><br><span class="line">    <span class="comment">// 根据第三条规则的定义！类型是RepeatableAnnotation[] </span></span><br><span class="line">    RepeatableAnnotation[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在<code>RepeatableAnnotation</code>标记上<code>@Repeatable</code>注解！指定其对应的容器注解！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="comment">// @Repeatable的源代码中是带有一个Class&lt;? extends Annotation&gt; value();成员的还记得不？</span></span><br><span class="line"><span class="meta">@Repeatable(RepeatableAnnotations.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RepeatableAnnotation &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">description</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在分别在<code>ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.TYPE</code>上进行标记，可以看到只有<code>ElementType.TYPE</code>无法重复！</p>
<p>可以通过反射<code>API</code>中的<code>getAnnotationsByType(RepeatableAnnotation.class)</code>来获取重复的注解！</p>
<blockquote>
<p>src/main/java/cn/argento/askia/annotation/repeat/RepeatableTest.java</p>
</blockquote>
<h4 id="文档注解"><a href="#文档注解" class="headerlink" title="文档注解"></a>文档注解</h4><p>该注解主要和<code>javadoc</code>文档有关，如果希望注解被记录在文档，则标上即可，这里引用<code>core java</code>的说明：</p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20230904173434895.png" alt="image-20230904173434895"></p>
<h4 id="本地变量"><a href="#本地变量" class="headerlink" title="本地变量"></a>本地变量</h4><p>首先查看一下<code>@Native</code>注解的源码信息，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Indicates that a field defining a constant value may be referenced</span></span><br><span class="line"><span class="comment"> * from native code.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The annotation may be used as a hint by tools that generate native</span></span><br><span class="line"><span class="comment"> * header files to determine whether a header file is required, and</span></span><br><span class="line"><span class="comment"> * if so, what declarations it should contain.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Target(ElementType.FIELD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Native &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到<code>@Native</code>注解自<code>jdk1.8</code>引入，用于解释该字段是一个常量，其值引用<code>native code</code>，该注解更多和<code>@Override</code>一样，是起到纯标记作用！可以发现它的保留时间为<code>SOURCE</code>阶段，这个用的不是很多，在<code>JNI</code>中可能用到，常常被代码生成工具使用。</p>
<h4 id="重写方法"><a href="#重写方法" class="headerlink" title="重写方法"></a>重写方法</h4><p><code>@Override</code>注解标记的方法是重写方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Override &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作为一种习惯，建议在所有的重写方法上都标记该注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Father</span></span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="废弃方法"><a href="#废弃方法" class="headerlink" title="废弃方法"></a>废弃方法</h4><p>标记<code>@Deprecated</code>的方法作为是废弃方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(value=&#123;CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, PARAMETER, TYPE&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Deprecated &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><code>@Deprecated</code>标记的内容，在被使用时会被加上删除线</strong></p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20230904175630852.png" alt="image-20230904175630852"></p>
<h4 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h4><p>只有一个公开方法（<code>public</code>，<code>default</code>方法不算）的接口就被称之为函数式接口，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FatherInterface</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size() == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isNotEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> !isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以在这些函数式接口上标记<code>@FunctionalInterface</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FatherInterface</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size() == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isNotEmpty</span><span class="params">()</span></span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> !isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="安全可变参数"><a href="#安全可变参数" class="headerlink" title="安全可变参数"></a>安全可变参数</h4><p><code>@SafeVarargs</code>用于标记可变参数是安全的，在声明具有<strong>模糊类型（比如：泛型）的可变参数的构造函数或方法时</strong>，<code>Java</code>编译器会报<code>unchecked</code>警告。鉴于这些情况，如果程序员断定声明的构造函数和方法的主体不会对其可变参数执行潜在的不安全的操作，可使用<code>@SafeVarargs</code>进行标记，这样的话，<code>Java</code>编译器就不会报<code>unchecked</code>警告。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.CONSTRUCTOR, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SafeVarargs &#123;&#125;</span><br></pre></td></tr></table></figure>
<p><strong>@SafeVarargs注解，对于非static或非final声明的方法，不适用，会编译不通过，对于非static或非final声明的方法，请使用@SuppressWarnings(“unchecked”)</strong></p>
<h4 id="警告抑制"><a href="#警告抑制" class="headerlink" title="警告抑制"></a>警告抑制</h4><p><code>@SuppressWarnings</code>用于忽略某些警告，如上面的<code>unchecked</code>，参数<code>Value</code>可以填入警告类型，支持同时抑制多种警告</p>
<blockquote>
<p>2023.12.17：@SuppressWarnings的可选项取决于你使用哪个发行商的<code>Java</code>编译器的哪个版本以及所使用的<code>IDE</code>环境!</p>
<p>如<code>eclipse</code>支持的选项参考：<a target="_blank" rel="noopener" href="https://help.eclipse.org/latest/index.jsp?topic=/org.eclipse.jdt.doc.user/tasks/task-suppress_warnings.htm，">https://help.eclipse.org/latest/index.jsp?topic=/org.eclipse.jdt.doc.user/tasks/task-suppress_warnings.htm，</a></p>
<p><code>idea</code>的参考选项：<a target="_blank" rel="noopener" href="https://gist.github.com/vegaasen/157fbc6dce8545b7f12c">https://gist.github.com/vegaasen/157fbc6dce8545b7f12c</a></p>
<p>其中<code>Java</code>语言规范中规定，任何的编译器和<code>IDE</code>都需要实现这两个选项：<code>unchecked</code>和<code>deprecation</code>，可以使用<code>javac -X</code>指令来查看当前版本编译器支持的选项！<img src="/2024/04/17/Java/Java%20Annotation/image-20231217224830464.png" alt="image-20231217224830464"></p>
<p><code>idea</code>支持自动生成<code>@Suppresswarnings</code>注解的值：<a target="_blank" rel="noopener" href="https://www.jetbrains.com/help/idea/disabling-and-enabling-inspections.html#suppress-inspections">https://www.jetbrains.com/help/idea/disabling-and-enabling-inspections.html#suppress-inspections</a></p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20231217223554656.png" alt="image-20231217223554656"></p>
<p>ref：<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1205995/what-is-the-list-of-valid-suppresswarnings-warning-names-in-java">https://stackoverflow.com/questions/1205995/what-is-the-list-of-valid-suppresswarnings-warning-names-in-java</a></p>
</blockquote>
<p>可惜我并没有找到关于这个注解的<code>value</code>值有哪些，下表中的值来源于各大网站：</p>
<p>部分无法翻译的或者没有把握是什么意思的则保留原文，写未知的则代表该警告值不知道用在什么用途但确实存在该值！部分地方提供了<code>idea</code>的警告显示！</p>
<p>加粗的为常用值：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>value</th>
<th>中文描述</th>
<th>IDEA中警告显示</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>all</strong></td>
<td><strong>压制所有警告</strong></td>
<td></td>
</tr>
<tr>
<td><code>boxing</code></td>
<td>抑制装箱、拆箱的警告</td>
<td></td>
</tr>
<tr>
<td><strong>cast</strong></td>
<td><strong>抑制强制转换产生的警告</strong></td>
<td></td>
</tr>
<tr>
<td><strong>dep-ann</strong></td>
<td><strong>抑制使用了@deprecated的注解</strong></td>
<td></td>
</tr>
<tr>
<td><strong>deprecation</strong></td>
<td><strong>抑制使用了@deprecated的方法或者字段</strong></td>
<td></td>
</tr>
<tr>
<td><strong>fallthrough</strong></td>
<td><strong>抑制在switch中缺失break的警告</strong></td>
<td></td>
</tr>
<tr>
<td><code>FragmentNotInstantiable</code></td>
<td>未知</td>
<td></td>
</tr>
<tr>
<td><strong>finally</strong></td>
<td><strong>抑制finally模块不返回的警告</strong></td>
<td></td>
</tr>
<tr>
<td><code>hiding</code></td>
<td><code>to suppress warnings relative to locals that hide variable</code></td>
<td></td>
</tr>
<tr>
<td><code>incomplete-switch</code></td>
<td>忽略没有<code>case</code>的<code>switch</code>语句警告</td>
<td></td>
</tr>
<tr>
<td><code>nls</code></td>
<td><code>to suppress warnings relative to non-nls string literals</code></td>
<td></td>
</tr>
<tr>
<td><code>null</code></td>
<td>忽略对<code>null</code>的操作（<code>to suppress warnings relative to null analysis</code>）</td>
<td></td>
</tr>
<tr>
<td><code>path</code></td>
<td>在类路径、源文件路径等中有不存在的路径时的警告。</td>
<td></td>
</tr>
<tr>
<td><code>PointlessBitwiseExpression</code></td>
<td>未知</td>
<td></td>
</tr>
<tr>
<td><strong>rawtypes</strong></td>
<td><strong>使用泛型时忽略没有指定相应类型的警告</strong></td>
<td></td>
</tr>
<tr>
<td><code>restriction</code></td>
<td><code>to suppress warnings relative to usage of discouraged or forbidden references</code></td>
<td></td>
</tr>
<tr>
<td><code>ReferenceEquality</code></td>
<td>未知</td>
<td></td>
</tr>
<tr>
<td><code>ResultOfMethodCallIgnored</code></td>
<td>压制返回值被忽略的警告</td>
<td><img src="/2024/04/17/Java/Java%20Annotation/image-20230904190541973.png" alt="image-20230904190541973"></td>
</tr>
<tr>
<td><code>SameParameterValue</code></td>
<td>压制参数总是等于某个值的警告</td>
<td><img src="/2024/04/17/Java/Java%20Annotation/image-20230904190416564.png" alt="image-20230904190416564"></td>
</tr>
<tr>
<td><strong>serial</strong></td>
<td><strong>忽略在serializable类中没有声明serialVersionUID变量</strong></td>
<td></td>
</tr>
<tr>
<td><code>static-access</code></td>
<td>抑制不正确的静态访问方式警告（<code>to suppress warnings relative to incorrect static access</code>）</td>
<td></td>
</tr>
<tr>
<td><code>sunapi</code></td>
<td><code>sunapi suppresses javac&#39;s warning about using Unsafe; &#39;all&#39; suppresses eclipse&#39;s warning about the unspecified &#39;sunapi&#39; key. Leave them both. Yes, javac&#39;s definition of the word &#39;all&#39; is quite contrary to what the dictionary says it means. &#39;all&#39; does NOT include &#39;sunapi&#39; according to javac.</code></td>
<td>来自<code>Lombok</code></td>
</tr>
<tr>
<td><code>synthetic-access</code></td>
<td>抑制子类没有按最优方法访问内部类的警告（<code>to suppress warnings relative to unoptimized access from inner classes</code>）</td>
<td></td>
</tr>
<tr>
<td><strong>try</strong></td>
<td><strong>抑制没有catch时的警告</strong></td>
<td></td>
</tr>
<tr>
<td><strong>unchecked</strong></td>
<td><strong>抑制没有进行类型检查操作的警告</strong></td>
<td></td>
</tr>
<tr>
<td><code>unqualified-field-access</code></td>
<td>抑制没有权限访问的字段的警告（<code>to suppress warnings relative to field access unqualified</code>）</td>
<td></td>
</tr>
<tr>
<td><code>NullableProblems</code></td>
<td>未知</td>
<td></td>
</tr>
<tr>
<td><strong>unused</strong></td>
<td><strong>抑制没被使用过的代码（方法、字段、局部变量等）的警告，有几个子抑制，如：UnusedReturnValue、UnusedParameters</strong></td>
<td></td>
</tr>
<tr>
<td><code>UnusedReturnValue</code></td>
<td>压制方法返回值从未被使用</td>
<td><img src="/2024/04/17/Java/Java%20Annotation/image-20230904184612017.png" alt="image-20230904184612017"></td>
</tr>
<tr>
<td><code>UnusedParameters</code></td>
<td>压制未使用的方法参数</td>
<td></td>
</tr>
<tr>
<td><code>WeakerAccess</code></td>
<td>未知</td>
</tr>
</tbody>
</table>
</div>
<h3 id="注解处理器"><a href="#注解处理器" class="headerlink" title="注解处理器"></a>注解处理器</h3><p>根据注解的三种存储策略，因此处理不同策略的注解要使用对应的方式。</p>
<p>需要注意，注解处理器的处理能力有限，部分注解的处理难度相当大，如<code>@Target(ElementType.TYPE_USE)</code>，还有一些，如<code>@Target(ElementType.LOCAL_VARIABLE)</code>级别的注解，目前没有更多有效的获取方式！</p>
<p>另外注解处理方法也存在通用性，一般：</p>
<ol>
<li><code>SOURCE</code>级别的注解处理手段同样适用于<code>CLASS</code>级别和<code>RUNTIME</code>级别</li>
<li>因为<code>RUNTIME</code>级别注解也会存在字节码中，所以使用<code>CLASS</code>级别的注解处理方法也能处理<code>RUNTIME</code>级别的注解</li>
</ol>
<h4 id="RUNTIME级别注解处理"><a href="#RUNTIME级别注解处理" class="headerlink" title="RUNTIME级别注解处理"></a>RUNTIME级别注解处理</h4><p>在反射<code>API</code>中，有一套专门处理注解的<code>API</code>，这些<code>API</code>位于<code>java.lang.reflect</code>包中，包括所有以<code>AnnotatedXXX</code>的接口：</p>
<ul>
<li><code>AnnotatedElement</code>：代表被注解标记的元素，如被一个或者多个注解标记的类、字段、方法等。（<code>JDK 1.5</code>），<code>AnnotatedElement</code>接口是整个<code>RUNTIME</code>级别注解处理中最核心的接口！</li>
<li><code>AnnotatedType</code>：代表被注解的元素的类型，在<code>Type</code>系统引入之后同时引入的接口，该接口继承自<code>AnnotatedElement</code>，不仅拥有获取、处理注解的能力，还返回一个<code>Type</code>对象，代表一个对象、方法参数、返回值、异常等所属的具体类型（<code>JDK 1.8</code>）</li>
<li><code>AnnotatedArrayType</code>：代表被注解的类型是一个数组类型，如<code>String[]</code>，该接口是<code>AnnotatedType</code>的子接口（<code>JDK 1.8</code>）</li>
<li><code>AnnotatedParameterizedType</code>：代表被注解的类型是一个参数化类型（泛型），如<code>List&lt;String&gt;</code>、<code>Set&lt;List&lt;String&gt;&gt;</code>等，该接口是<code>AnnotatedType</code>的子接口（<code>JDK 1.8</code>）</li>
<li><code>AnnotatedTypeVariable</code>：代表被注解的类型是一个泛型变量，如<code>T</code>、<code>U</code>、<code>S</code>，该接口是<code>AnnotatedType</code>的子接口（<code>JDK 1.8</code>）</li>
<li><code>AnnotatedWildcardType</code>：代表被注解的类型是一个继承性的泛型，如：<code>List&lt;? extends MyClass&gt;</code>、<code>List&lt;T extends MyClass&gt;</code>（<code>JDK 1.8</code>）</li>
</ul>
<p>除了上面的<code>6</code>大接口外，还有一个类<code>AnnotatedTypeBaseImpl</code>，它代表所有除上面<code>6</code>大接口对应的类型外的其他类型，如<code>String</code>、<code>Integer</code>、<code>int</code>等都会返回<code>AnnotatedTypeBaseImpl</code>实现，该类在<code>sun.reflect.annotation</code>包下！</p>
<p><code>AnnotatedElement</code>可以说是整个处理中最核心，最重要的接口，其主要用于获取标记在元素（如类、方法、字段等）上的注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotatedElement</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// JDK 1.5</span></span><br><span class="line">    <span class="comment">// 判断类、字段、构造器、方法上是否有某个注解</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isAnnotationPresent</span><span class="params">(Class&lt;? extends Annotation&gt; annotationClass)</span></span>;</span><br><span class="line">    <span class="comment">// JDK 1.5</span></span><br><span class="line">    <span class="comment">// 获取类、字段、构造器、方法上的某个特定注解，包括类上的可继承性的注解</span></span><br><span class="line">    &lt;T extends Annotation&gt; <span class="function">T <span class="title">getAnnotation</span><span class="params">(Class&lt;T&gt; annotationClass)</span></span>;</span><br><span class="line">    <span class="comment">// JDK 1.5</span></span><br><span class="line">    <span class="comment">// 获取类、字段、构造器、方法上的所有注解，包括可重复的注解（可重复注解容器来获得可重复的注解）</span></span><br><span class="line">    Annotation[] getAnnotations();</span><br><span class="line">    <span class="comment">// JDK 1.8</span></span><br><span class="line">    <span class="comment">// 获取类、字段、构造器、方法上的可重复注解！</span></span><br><span class="line">    <span class="keyword">default</span> &lt;T extends Annotation&gt; T[] getAnnotationsByType(Class&lt;T&gt; annotationClass);</span><br><span class="line">    <span class="comment">// JDK 1.8</span></span><br><span class="line">    <span class="comment">// 和getAnnotation()方法相同，但不能获取继承性的注解</span></span><br><span class="line">    <span class="keyword">default</span> &lt;T extends Annotation&gt; <span class="function">T <span class="title">getDeclaredAnnotation</span><span class="params">(Class&lt;T&gt; annotationClass)</span></span>;</span><br><span class="line">    <span class="comment">// JDK 1.8</span></span><br><span class="line">    <span class="comment">// 和getAnnotationsByType方法相同，但不能获取继承性的可重复注解</span></span><br><span class="line">    <span class="keyword">default</span> &lt;T extends Annotation&gt; T[] getDeclaredAnnotationsByType(Class&lt;T&gt; annotationClass);</span><br><span class="line">    <span class="comment">// JDK 1.5</span></span><br><span class="line">    <span class="comment">// 和getAnnotations()方法相同，但不能获取继承性的可重复注解</span></span><br><span class="line">    Annotation[] getDeclaredAnnotations();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相关的<code>Demo</code>可以参考:</p>
<blockquote>
<p>src/main/java/cn/argento/askia/annotation/runtime/AnnotationAPIs.java</p>
</blockquote>
<p><code>AnnotatedElement</code>接口的所有子接口和类基本可以分成两大类：一类是以<code>AnnotatedType</code>及其子接口为主代表类型的接口，另一类则是形如<code>Class&lt;T&gt;</code>、<code>Constructor&lt;T&gt;</code>等对象的组成元素！采用这种设计能帮让你在获取注解的同时获取相关元素的类型，如获取标记在方法返回值上的注解的同时获取该方法返回值的类型！</p>
<p><code>AnnotatedType</code>及其所有的子接口除了用于获取注解外，额外提供了用于获取具体类型的功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AnnotatedType接口</span></span><br><span class="line"><span class="comment">// JDK 1.8</span></span><br><span class="line"><span class="comment">// 获取类型名称</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotatedType</span> <span class="keyword">extends</span> <span class="title">AnnotatedElement</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取Type对象，代表一个类型</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Type <span class="title">getType</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AnnotatedArrayType接口</span></span><br><span class="line"><span class="comment">// 代表数组类型：T[]、String[]</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotatedArrayType</span> <span class="keyword">extends</span> <span class="title">AnnotatedType</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取标记在数组上的原始类型,如String[]则获取的是String, T[]则获取的是T</span></span><br><span class="line">    <span class="comment">//（注意该类型可能是一个泛型变量，所以返回类型还是一个AnnotatedType）</span></span><br><span class="line">    <span class="comment">// 如T[]调用该方法将获取AnnotatedTypeVariable对象，代表泛型变量T</span></span><br><span class="line">    <span class="function">AnnotatedType  <span class="title">getAnnotatedGenericComponentType</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AnnotatedParameterizedType接口</span></span><br><span class="line"><span class="comment">// 代表参数化类型：List&lt;String&gt;、Map&lt;String,Object&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotatedParameterizedType</span> <span class="keyword">extends</span> <span class="title">AnnotatedType</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取泛型的具体类型，如List&lt;String&gt;则返回String类型, Map&lt;String, Object&gt;则返回String类型、Object类型（AnnotatedTypeBaseImpl实现）</span></span><br><span class="line">    AnnotatedType[] getAnnotatedActualTypeArguments();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AnnotatedTypeVariable接口</span></span><br><span class="line"><span class="comment">// 代表类型参数，如T、T extends Number</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotatedTypeVariable</span> <span class="keyword">extends</span> <span class="title">AnnotatedType</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取泛型的界，如T extends Number则返回Number、T则返回Object</span></span><br><span class="line">    <span class="comment">// 同样的理由，由于获取的可能还是一个参数化类型，如：T extends List&lt;String&gt;</span></span><br><span class="line">    <span class="comment">// T extends List&lt;String&gt;返回的List&lt;String&gt;仍然是一个参数化类型（AnnotatedParameterizedType）</span></span><br><span class="line">    AnnotatedType[] getAnnotatedBounds();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// AnnotatedWildcardType接口</span></span><br><span class="line"><span class="comment">// 如? extends Number，? super Integer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AnnotatedWildcardType</span> <span class="keyword">extends</span> <span class="title">AnnotatedType</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取下界，如? super Integer则返回Integer</span></span><br><span class="line">    AnnotatedType[] getAnnotatedLowerBounds();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取上界，如? extends Number则返回Number</span></span><br><span class="line">    AnnotatedType[] getAnnotatedUpperBounds();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而另外一类继承了<code>AnnotatedElement</code>接口的对象组成元素，这些对象组成元素可能有多个可被注解标注的地方，比如：在方法上，注解可以标记在方法返回值、方法参数，如果方法抛出异常，则还有可能会标记在异常上！因此通常对象组成元素提供了各种<code>getAnnotatedXXX()</code>方法来获取在这些特定位置上的<code>AnnotatedType</code>及其子接口实例！</p>
<p>继承了<code>AnnotatedElement</code>接口的对象组成元素主要有：<code>Class&lt;T&gt;</code>、<code>Constructor&lt;T&gt;</code> 、<code>Field</code>、<code>Method</code>、<code>Package</code>、<code>Parameter</code>，其中他们的获取方法如下：</p>
<ul>
<li><code>Constructor</code>、<code>Method</code>的<code>getAnnotatedReturnType()</code>、<code>getAnnotatedReceiverType()</code>、<code>getAnnotatedParameterTypes()</code>、<code>getAnnotatedExceptionTypes()</code></li>
<li><code>Field</code>、<code>Parameter</code>的<code>getAnnotatedType()</code></li>
<li><code>Class</code>类上的<code>getAnnotatedSuperclass()</code>、<code>getAnnotatedInterfaces()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取标记在方法、构造器上的可被注解的异常的类型</span></span><br><span class="line"><span class="keyword">public</span> AnnotatedType[] getAnnotatedExceptionTypes();</span><br><span class="line"><span class="comment">// 获取标记在方法、构造器上的可被注解的参数的类型</span></span><br><span class="line"><span class="keyword">public</span> AnnotatedType[] getAnnotatedParameterTypes();</span><br><span class="line"><span class="comment">// 获取标记在方法、构造器上的可被注解的接收器类型，所谓接收器类型指的是this</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AnnotatedType <span class="title">getAnnotatedReceiverType</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 获取标记在方法上的可被注解的返回值的类型</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> AnnotatedType <span class="title">getAnnotatedReturnType</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 获取标记在字段、参数上的可被注解的类型</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AnnotatedType <span class="title">getAnnotatedType</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 获取类上的可被注解的父类、父接口类型</span></span><br><span class="line"><span class="keyword">public</span> AnnotatedType[] getAnnotatedInterfaces();</span><br><span class="line"><span class="function"><span class="keyword">public</span> AnnotatedType <span class="title">getAnnotatedSuperclass</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Demo参考：src/main/java/cn/argento/askia/annotation/runtime/AnnotatedAPIs.java</p>
</blockquote>
<p><code>receiverType</code>指的是这种类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span>&lt;@<span class="title">MyAnnotation</span> <span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 下面的@MyAnnotation MyClass&lt;T&gt; this就是receiverType,参数名必须是this,</span></span><br><span class="line">    <span class="comment">// 实际上就是this对象</span></span><br><span class="line">    <span class="comment">// 当我们需要对this进行一些标记的时候，就可以使用这种方式定义,</span></span><br><span class="line">    <span class="comment">// 一般这种情况不常见！</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myMethod</span><span class="params">(<span class="meta">@MyAnnotation</span> MyClass&lt;T&gt; <span class="keyword">this</span>)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>特别注意，<code>method.getAnnotatedReceiverType().getAnnotations()</code>和<code>method.getAnnotations()</code>的区别：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myMethod</span><span class="params">(<span class="meta">@MyAnnotation</span> MyClass <span class="keyword">this</span>)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">             MyClass obj = <span class="keyword">new</span> MyClass&lt;&gt;();</span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();</span><br><span class="line">        Method md = clazz.getMethod(<span class="string">&quot;myMethod&quot;</span>);</span><br><span class="line">   </span><br><span class="line">        <span class="comment">// 该方法获取的是标记在方法上的注解</span></span><br><span class="line">        Annotation[] myMethods = md.getAnnotations();</span><br><span class="line">     <span class="comment">// 结果：[]</span></span><br><span class="line">        <span class="comment">// 该方法获取的是标记在方法参数this上的注解！</span></span><br><span class="line">        AnnotatedType annotatedType = md.getAnnotatedReceiverType();</span><br><span class="line">        Annotation[] annotations = annotatedType.getAnnotations();</span><br><span class="line">        <span class="comment">// 结果 [MyAnnotation]</span></span><br><span class="line">   </span><br><span class="line">        </span><br><span class="line">         &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>method.getAnnotatedReceiverType().getAnnotations()</code> 是获取方法receiverType上的注解</li>
<li><code>method.getAnnotations()</code>是获取标记在方法上的注解！</li>
<li>同理应用于其他<code>getAnnotatedXXXX()</code>方法</li>
<li>参考：src/main/java/cn/argento/askia/annotation/runtime/MyClass.java</li>
</ul>
<p>2024.2.19</p>
<p>对同一个<code>Class</code>对象，调用多次getAnnotation()（对getDeclaredAnnotation()同理）将获取相同引用对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Utility(name = &quot;AnnotationProcessingHelper&quot;, version = &quot;1.0&quot;)</span><br><span class="line">public class A &#123;</span><br><span class="line">&#125;</span><br><span class="line">@Utility(name = &quot;AnnotationProcessingHelper&quot;, version = &quot;1.0&quot;)</span><br><span class="line">public class B&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String[] args)&#123;</span><br><span class="line">	    final Utility annotation = A.class.getAnnotation(Utility.class);</span><br><span class="line">        final Utility annotation1 = A.class.getAnnotation(Utility.class);</span><br><span class="line">        final Utility annotation2 = B.class.getAnnotation(Utility.class);</span><br><span class="line">        final Utility annotation3 = B.class.getAnnotation(Utility.class);</span><br><span class="line">        System.out.println(annotation == annotation1);	// true</span><br><span class="line">        System.out.println(annotation2 == annotation1);	// false</span><br><span class="line">        System.out.println(annotation3 == annotation2);	// true</span><br><span class="line">        System.out.println(annotation2.equals(annotation1)); // true</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是因为Class类中使用Map来记录所有获取过的注解，当注解第一次被获取并创建对象之后就会被存放在这个Map中（缓存起来），下一次在获取不会重新创建而是直接在这个Map中拿！因此它们实际上是同一个对象</p>
<p>注解中的equals()的比较原理是比较各个属性是否相同，因此只需要属性值相同即可而无需考虑是否来自相同的Class对象</p>
</blockquote>
<h4 id="SOURCE级别的注解处理"><a href="#SOURCE级别的注解处理" class="headerlink" title="SOURCE级别的注解处理"></a>SOURCE级别的注解处理</h4><p><code>source</code>级别的注解在编译的时候会被去除，所以唯一能对该类注解进行处理的就是在编译<code>java</code>代码之前，也就是在将<code>java</code>代码编译成字节码这个过程之前进行处理，基于这个特性决定了处理这些<code>SOURCE</code>级别的注解最好的工具就是<code>javac.exe</code>，也就是<code>java</code>编译器（这样可以方便在处理完注解之后立即进行源代码的编译）</p>
<p><code>JDK 5</code>时期提供了一个可以处理注解的命令行工具：<code>Annotation Processing Tool</code>（<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/6/docs/technotes/guides/apt/"><code>APT</code></a>），可惜工具没有集成到<code>javac.exe</code>，需要额外运行，并且<code>api</code>在<code>com.sun.mirror</code>包下而非标准包，因此<code>APT</code>在<code>JDK 7</code>以后就被废弃了，取而代之的是<code>JDK 6</code>加入的<code>PAP</code>（<code>Pluggable Annotation Processinig API</code>，插件式注解处理<code>API</code>），该<code>API</code>解决了<code>APT</code>工具遗留的问题。该<code>API</code>位于<code>javax.annotation.processing</code>包中，其中的核心是：</p>
<ul>
<li><p><code>Processor</code>接口：注解处理器顶层接口</p>
</li>
<li><p><code>AbstractProcessor</code>抽象类：抽象注解处理器，对顶层接口中的部分方法提供了实现，需要自定义处理器时继承该抽象类即可！</p>
</li>
<li><code>@SupportedAnnotationTypes</code>：待处理的注解的全限定类名</li>
<li><code>@SupportedOptions</code>：用于指定<code>javac</code>编译代码的编译参数</li>
<li><code>@SupportedSourceVersion</code>：待处理的注解的源代码版本</li>
<li><code>ProcessingEnvironment</code>接口：代表处理注解环境</li>
<li><code>RoundEnvironment</code>接口：代表注解轮询处理环境接口</li>
<li><code>Messager</code>接口：代表处理过程中产生的警告信息！</li>
<li><code>Filer</code>接口：</li>
</ul>
<p>定义一个注解处理器只需要继承<code>AbstractProcess</code>抽象类实现<code>process()</code>方法即可，并且使用<code>@SupportedAnnotationTypes</code>和<code>@SupportedAnnotationTypes</code>指定需要处理的注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SupportedAnnotationTypes(&quot;cn.argento.askia.processors.source.ToString&quot;)</span></span><br><span class="line"><span class="meta">@SupportedSourceVersion(SourceVersion.RELEASE_8)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToStringAnnotationProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.RetentionPolicy.*;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(&#123;TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ToString &#123;</span><br><span class="line">    <span class="function">String <span class="title">delimiter</span><span class="params">()</span> <span class="keyword">default</span> &quot;, &quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">ignoreFieldName</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">appendHashCode</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以使用<code>@SupportedOptions()</code>指定编译参数，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SupportedAnnotationTypes(&quot;cn.argento.askia.processors.source.ToString&quot;)</span></span><br><span class="line"><span class="meta">@SupportedSourceVersion(SourceVersion.RELEASE_8)</span></span><br><span class="line"><span class="meta">@SupportedOptions(&quot;-parameters&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ToStringAnnotationProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">process</span><span class="params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>源码级注解处理器理论上只能生成新的源代码文件，而无法修改现有的源代码，想要实现修改现有源代码，可以通过修改字节码实现，但源码级注解处理器却可以干预<code>javac</code>对源代码的分析，从而干预字节码的最终生成。<code>javac</code>对源代码进行分析时，会生成一棵抽象语法树（<code>AST</code>），最终编译出来的字节码也是以这颗<code>AST</code>为原型进行编译的，类似于<code>DOM</code>的<code>XML</code>。可以通过直接修改<code>AST</code>的节点的形式来改变最终的字节码的生成，举例就是<code>Lombok</code>中的<code>@Data</code>注解为实体类添加<code>Getter</code>、<code>Setter</code>方法！特别注意这种修改<code>AST</code>的方式并没有修改源文件，只是对源文件做了增强，类似于<code>AOP</code>！</p>
<p>但想要修改<code>AST</code>并非易事，首先修改<code>AST</code>的相关<code>API</code>并没有标准化（在<code>tools.jar</code>中），这意味着需要自行承担使用<code>tools.jar</code>中代码产生的所有风险，其次这些<code>API</code>可能缺少文档和<code>Demo</code>，需要自行研究（这才是使用这些<code>API</code>最大的阻碍！）。</p>
<p>我们先介绍如何使用源码注解处理器来生成新的代码源文件，在注解处理器中，核心就是<code>process()</code>方法的参数，以及<code>AbstractProcessor</code>类中的<code>processingEnv</code>变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;? extends TypeElement&gt; annotations：</span><br><span class="line">代表要处理的注解，其值是<span class="meta">@SupportedAnnotationTypes()</span>的value值</span><br><span class="line"></span><br><span class="line">RoundEnvironment currentRoundEnv：</span><br><span class="line">代表轮询环境。process()会被轮询调用，因为源代码上可能拥有多个注解，需要多个注解处理器进行处理，所以会多次调用process()运行每一个注解处理器。即一个源码级别的注解处理器会触发一次process()</span><br><span class="line">在每一轮中，process()都会被调用一次，调用时会传递改轮中所有文件中发现的所有注解构成的Set集合，以及当前的处理轮询的信息的RoundEnvironment引用。   </span><br></pre></td></tr></table></figure>
<p>关于<code>RoundEnvironment</code>，它主要有三个方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;? extends Element&gt; getRootElements();	<span class="comment">// 返回当前注解处理器输入的文件</span></span><br><span class="line">Set&lt;? extends Element&gt; getElementsAnnotatedWith(TypeElement a);	<span class="comment">// 获取标记了a注解的所有类、字段、方法等元素</span></span><br><span class="line">Set&lt;? extends Element&gt; getElementsAnnotatedWith(Class&lt;? extends Annotation&gt; a);</span><br><span class="line"><span class="comment">// 同上</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">errorRaised</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 判断是否出现错误！</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">processingOver</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 判断是否处理结束</span></span><br></pre></td></tr></table></figure>
<p>前面有提到，虽然我们无法直接使用现有的标准化的<code>API</code>来修改<code>AST</code>树，但<code>JDK</code>还是提供了相应的<code>API</code>供我们访问<code>AST</code>树中的各种节点，它们叫语言模型<code>API</code>，位于<code>javax.lang.model</code>包中，注解处理器使用到了其下的<code>element</code>子包，在该子包下定义了各类<code>AST</code>树的节点接口：</p>
<ul>
<li><code>TypeElement</code>：代表一个类型节点，可以代表一个注解类型、类、接口、枚举等等</li>
<li><code>TypeParameterElement</code>：代表泛型参数节点，如<code>T</code>，<code>V extends Number</code></li>
<li><code>VariableElement</code>：代表字段，变量，方法参数等</li>
<li><code>PackageElement</code>：代表包</li>
<li><code>ExecutableElement</code>：代表可执行的元素，如方法、构造器</li>
</ul>
<p>这里简单介绍下各个节点接口的<code>API</code>，更多的细节参考<code>LanguageModel</code>模块：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Element接口，这是所有节点接口的父接口</span></span><br><span class="line"><span class="comment">// 获取注解的类型（包含全限定类名和TypeMirror的一些判别方法）</span></span><br><span class="line"><span class="function">TypeMirror <span class="title">asType</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 获取注解的类型</span></span><br><span class="line"><span class="function">ElementKind <span class="title">getKind</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 获取修饰符，如public等</span></span><br><span class="line"><span class="function">Set&lt;Modifier&gt; <span class="title">getModifiers</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 获取简单名称，各子节点接口获取的值不一样，如类则是类名，方法则是获取方法名，字段则是字段名，构造器一般返回&lt;init&gt;</span></span><br><span class="line"><span class="function">Name <span class="title">getSimpleName</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">Element <span class="title">getEnclosingElement</span><span class="params">()</span></span>;</span><br><span class="line">List&lt;? extends Element&gt; getEnclosedElements();</span><br><span class="line"><span class="comment">// 获取标记在</span></span><br><span class="line">List&lt;? extends AnnotationMirror&gt; getAnnotationMirrors();</span><br><span class="line"><span class="comment">// 获取节点上的注解，注意，此处的getAnnotation()即使注解是SOURCE级别，也可以获取！</span></span><br><span class="line">&lt;A extends Annotation&gt; <span class="function">A <span class="title">getAnnotation</span><span class="params">(Class&lt;A&gt; annotationType)</span></span>;</span><br><span class="line"><span class="comment">// 获取节点上的可重复注解，注意，此处的getAnnotation()即使注解是SOURCE级别，也可以获取！</span></span><br><span class="line">&lt;A extends Annotation&gt; A[] getAnnotationsByType(Class&lt;A&gt; annotationType);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ExecutableElement接口</span></span><br><span class="line"><span class="function">AnnotationValue <span class="title">getDefaultValue</span><span class="params">()</span></span>;</span><br><span class="line">List&lt;? extends VariableElement&gt; getParameters();</span><br><span class="line"><span class="function">TypeMirror <span class="title">getReceiverType</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">TypeMirror <span class="title">getReturnType</span><span class="params">()</span></span>;</span><br><span class="line">List&lt;? extends TypeMirror&gt; getThrownTypes();</span><br><span class="line">List&lt;? extends TypeParameterElement&gt; getTypeParameters();</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isDefault</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isVarArgs</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">Name <span class="title">getQualifiedName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PackageElement接口</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isUnnamed</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TypeElement</span></span><br><span class="line">List&lt;? extends TypeMirror&gt; getInterfaces();</span><br><span class="line"><span class="function">NestingKind <span class="title">getNestingKind</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">TypeMirror <span class="title">getSuperclass</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">Name <span class="title">getQualifiedName</span><span class="params">()</span></span>;</span><br><span class="line">List&lt;? extends TypeParameterElement&gt; getTypeParameters();</span><br><span class="line"></span><br><span class="line"><span class="comment">// TypeParameterElement</span></span><br><span class="line"><span class="function">Element <span class="title">getGenericElement</span><span class="params">()</span></span>;</span><br><span class="line">List&lt;? extends TypeMirror&gt; getBounds();</span><br><span class="line"></span><br><span class="line"><span class="comment">// VariableElement</span></span><br><span class="line"><span class="function">Object <span class="title">getConstantValue</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p><code>ProcessingEnvironment</code>参数主要用于处理语言模型<code>API</code>，关于语言模型，请参考<code>LanguageModel</code>模块。其中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取传递给注解处理器的参数</span></span><br><span class="line"><span class="comment">// 也就是注解@SupportedOptions的值！</span></span><br><span class="line"><span class="function">Map&lt;String,String&gt; <span class="title">getOptions</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 返回用于报告错误、警告和其他通知的Message对象。</span></span><br><span class="line"><span class="function">Messager <span class="title">getMessager</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 返回用于创建源文件、类和辅助文件（xml、properties等）的Filer对象</span></span><br><span class="line"><span class="function">Filer <span class="title">getFiler</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 返回对Elements对象用于对一个类的元素（类名、包、是否被废弃等，具体见语言模型API的Element接口）</span></span><br><span class="line"><span class="function">Elements <span class="title">getElementUtils</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 返回Types对象用于对一个元素的类型进行解析</span></span><br><span class="line"><span class="function">Types <span class="title">getTypeUtils</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 获取源代码版本</span></span><br><span class="line"><span class="function">SourceVersion <span class="title">getSourceVersion</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">// 获取locale</span></span><br><span class="line"><span class="function">Locale <span class="title">getLocale</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>
<p>如果希望创建一个源文件，则可以使用<code>getFiler()</code>方法，获取<code>Filer</code>对象之后调用<code>createSourceFile()</code>获取一个<code>JavaFileObject</code>对象，该对象代表一个<code>Java</code>源文件，在编译器<code>API</code>一节中经常用到。</p>
<blockquote>
<p>那么如何编写一个注解处理器？可以按照下面的步骤：</p>
<ol>
<li>调用<code>RoundEnvironment</code>的<code>Set&lt;? extends Element&gt; getElementsAnnotatedWith(TypeElement a);</code>，传递<code>Set&lt;? extends TypeElement&gt; annotations：</code>参数来获取所有标记了该注解的<code>Element</code>对象</li>
<li>对标记了注解的元素进行处理，处理过程需要了解语言模型<code>API</code></li>
</ol>
<p>参考：Java-Annotation/src/main/java/cn/argento/askia/processors/source/ToStringAnnotationProcessor.java</p>
</blockquote>
<p>代码编写完之后就是编译的问题，那么如何编译注解处理器并使用注解处理器编译其他代码？</p>
<p>要想使用<code>Processor</code>处理源代码，你可以使用下面的方式：</p>
<ol>
<li><p>直接使用编译参数指定，格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">javac.exe -processor [注解处理器全限定类名<span class="number">1</span>, 注解处理器全限定类名<span class="number">2</span>, ...] [源代码<span class="number">1.</span>java, 源代码<span class="number">2.</span>java, ...]</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 如果希望能够看到轮询轮次，可以加上-XprintRounds参数：</span></span><br><span class="line">javac.exe -processor [注解处理器全限定类名<span class="number">1</span>, 注解处理器全限定类名<span class="number">2</span>, ...] [源代码<span class="number">1.</span>java, 源代码<span class="number">2.</span>java, ...] -XprintRounds</span><br><span class="line"><span class="comment">// 他会打印出如下的轮询信息（这信息可能使用中文的形式来输出）：</span></span><br><span class="line"><span class="comment">// Round 1:</span></span><br><span class="line"><span class="comment">//   input files: &#123;源代码1&#125;</span></span><br><span class="line"><span class="comment">//   annotations: [标记在源代码1上的SOURCE注解]</span></span><br><span class="line"><span class="comment">//   last round : false</span></span><br><span class="line"><span class="comment">// Round 2:</span></span><br><span class="line"><span class="comment">//   input files: &#123;生成的源代码&#125;</span></span><br><span class="line"><span class="comment">//   annotations: []</span></span><br><span class="line"><span class="comment">//   last round : false </span></span><br><span class="line"><span class="comment">// Round 3:</span></span><br><span class="line"><span class="comment">//   input files: &#123;&#125;</span></span><br><span class="line"><span class="comment">//   annotations: []</span></span><br><span class="line"><span class="comment">//   last round : true </span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通过服务注册（也就是所谓的<code>SPI</code>机制）指定，在项目根路径下创建：<code>META-INF/services/javax.annotation.processing.Processor</code>文件，添加上自己的注解处理器的全限定类名，多个注解处理器换行分割！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cn.argento.askia.processors.source.EnumInnerConstantProcessor</span><br><span class="line">cn.argento.askia.processors.source.ToStringAnnotationProcessor</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过<code>Maven</code>的编译插件的配置指定如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">               </span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">annotationProcessors</span>&gt;</span></span><br><span class="line">                  <span class="tag">&lt;<span class="name">annotationProcessor</span>&gt;</span></span><br><span class="line">                cn.argento.askia.processors.source.EnumInnerConstantProcessor</span><br><span class="line">            <span class="tag">&lt;/<span class="name">annotationProcessor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">annotationProcessors</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>使用这些方式的大前提是，<strong>注解处理器已经编译完成</strong>。因此您需要先对注解处理器进行编译再去编译带注解的源代码，或者是把注解处理器放到一个独立的<code>Jar</code>包引入，然后运行！</p>
<p>为了演示，我们先把所有源代码准备好，所有的源代码都位于<code>cn.argento.askia.processors.source</code>包下，<strong>如果你需要更换包，则可能需要修改注解处理器中的代码，因为该注解处理器生成的<code>Java</code>文件都是基于<code>cn.argento.askia.processors.source</code>包的</strong></p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20240205102954474.png" alt="image-20240205102954474"></p>
<h5 id="基于命令行编译运行"><a href="#基于命令行编译运行" class="headerlink" title="基于命令行编译运行"></a>基于命令行编译运行</h5><p>我们演示第一种编译方式。首先，我们需要先将注解处理器进行编译（特别注意，您的注解处理器应该也会依赖待处理的注解，<strong>如果有则要先把待处理的注解编译然后再编译注解处理器</strong>，<strong>基于命令参数的编译方式非常依赖类的编译顺序</strong>！）：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 编译注解</span><br><span class="line"># ToString.java所在位置：D:\MinecraftModProject\AnnotationProcessTest\src\main\java\cn\argento\askia\processors\source\ToString.java</span><br><span class="line"># 这要求您当前<span class="built_in">CMD</span>的位置是：D:\MinecraftModProject\AnnotationProcessTest\src\main\java\cn\argento\askia\processors\source\：</span><br><span class="line">javac -encoding utf-<span class="number">8</span> ToString.java</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># -----------------------------</span><br><span class="line"># 编译注解处理器</span><br><span class="line">javac -encoding utf-<span class="number">8</span> -classpath  D:\MinecraftModProject\AnnotationProcessTest\src\main\java  ToStringAnnotationProcessor.java</span><br></pre></td></tr></table></figure>
<ol>
<li><p>指定<code>encoding</code>参数是因为<code>Java</code>源代码文件内有中文，不加上这个参数会出现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">错误: 编码GBK的不可映射字符</span><br></pre></td></tr></table></figure>
</li>
<li><p>由于注解处理器的编译依赖注解<code>@ToSting</code>，当我们编译完<code>@ToString</code>之后，需要告诉<code>java</code>编译器<code>@ToString.class</code>所在的位置，即指定编译参数<code>-classpath</code>，该位置也比较特殊，需要去掉<code>@ToString</code>所在包，如<code>@ToString.class</code>所在位置是：<code>D:\MinecraftModProject\AnnotationProcessTest\src\main\java\cn\argento\askia\processors\source\ToString.java</code></p>
<p>所在包：<img src="/2024/04/17/Java/Java%20Annotation/image-20240205104204522.png" alt="image-20240205104204522"></p>
<p>则需要指定编译参数：<code>javac -classpath D:\MinecraftModProject\AnnotationProcessTest\src\main\java ToStringAnnotationProcessor.java</code></p>
</li>
</ol>
<p>然后，我们编译待处理用户类：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">javac -cp D:\OpenSourceProject\JavaProject\Java-Annotation\src\main\java -processor cn.argento.askia.processors.source.ToStringAnnotationProcessor User.java -XprintRounds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 生成的ToStrings.java会放在javac运行的回显位置，如你的<span class="built_in">cmd</span>是这样的：</span><br><span class="line"><span class="function">C:\<span class="title">Users</span>\<span class="title">asus</span>&gt;<span class="title">javac</span> -<span class="title">cp</span> <span class="title">D</span>:\<span class="title">OpenSourceProject</span>\<span class="title">JavaProject</span>\<span class="title">Java</span>-<span class="title">Annotation</span>\<span class="title">src</span>\<span class="title">main</span>\<span class="title">java</span> -<span class="title">processor</span> <span class="title">cn.argento.askia.processors.source.ToStringAnnotationProcessor</span> <span class="title">D</span>:\<span class="title">OpenSourceProject</span>\<span class="title">JavaProject</span>\<span class="title">Java</span>-<span class="title">Annotation</span>\<span class="title">src</span>\<span class="title">main</span>\<span class="title">java</span>\<span class="title">cn</span>\<span class="title">argento</span>\<span class="title">askia</span>\<span class="title">processors</span>\<span class="title">source</span>\<span class="title">User.java</span> -<span class="title">XprintRounds</span></span></span><br><span class="line"><span class="function"># 则生成的<span class="title">ToStrings.java</span>会放在<span class="title">C</span>:\<span class="title">Users</span>\<span class="title">asus</span>里面！</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"># 当然你可以使用-<span class="title">s</span> 参数指定生成的源文件的位置</span></span><br><span class="line"><span class="function"># 另外说一下 -<span class="title">d</span> 是指定生成的<span class="title">class</span>文件的位置</span></span><br><span class="line"><span class="function"># -<span class="title">h</span> 指定生成的头文件的位置</span></span><br><span class="line"><span class="function"><span class="title">javac</span> -<span class="title">s</span> <span class="title">D</span>:\ -<span class="title">cp</span> <span class="title">D</span>:\<span class="title">OpenSourceProject</span>\<span class="title">JavaProject</span>\<span class="title">Java</span>-<span class="title">Annotation</span>\<span class="title">src</span>\<span class="title">main</span>\<span class="title">java</span> -<span class="title">processor</span> <span class="title">cn.argento.askia.processors.source.ToStringAnnotationProcessor</span> <span class="title">D</span>:\<span class="title">OpenSourceProject</span>\<span class="title">JavaProject</span>\<span class="title">Java</span>-<span class="title">Annotation</span>\<span class="title">src</span>\<span class="title">main</span>\<span class="title">java</span>\<span class="title">cn</span>\<span class="title">argento</span>\<span class="title">askia</span>\<span class="title">processors</span>\<span class="title">source</span>\<span class="title">User.java</span> -<span class="title">XprintRounds</span></span></span><br></pre></td></tr></table></figure>
<p>编译过程会显示下面的注解处理循环信息：</p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20240205114800460.png" alt="image-20240205114800460"></p>
<p>等待编译完成之后，则在源代码中会出现生成的代码文件和字节码文件：</p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20240205115005156.png" alt="image-20240205115005156"></p>
<h5 id="基于服务注册编译运行"><a href="#基于服务注册编译运行" class="headerlink" title="基于服务注册编译运行"></a>基于服务注册编译运行</h5><ol>
<li>我们先将注解处理器代码和对应的注解代码放在一个新的项目中：</li>
</ol>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20240205142802476.png" alt="image-20240205142802476"></p>
<ol>
<li><p>在项目根目录中添加<code>SPI</code>文件，如果是普通的<code>Idea Java</code>项目，则在<code>src</code>添加，如果是<code>maven</code>项目，则在<code>resources</code><img src="/2024/04/17/Java/Java%20Annotation/image-20240205143827876.png" alt="image-20240205143827876"></p>
</li>
<li><p>SPI文件内填写注解处理器的全限定类名<img src="/2024/04/17/Java/Java%20Annotation/image-20240205143925642.png" alt="image-20240205143925642"></p>
</li>
<li><p>使用<code>IDEA</code>或者<code>Maven</code>编译成<code>jar</code>包，<img src="/2024/04/17/Java/Java%20Annotation/image-20240205145412555.png" alt="image-20240205145412555">请确保编译出来的<code>jar</code>包有如下文件：<img src="/2024/04/17/Java/Java%20Annotation/image-20240205145537976.png" alt="image-20240205145537976"><br><img src="/2024/04/17/Java/Java%20Annotation/image-20240205145632617.png" alt="image-20240205145632617"></p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20240205145735420.png" alt="image-20240205145735420"></p>
</li>
<li><p>接下来使用这个<code>Jar</code>包来编译<code>Java</code>文件（即使用<code>Javac</code>的<code>-cp</code>或者<code>-classpath</code>参数指定依赖的<code>Jar</code>）就可以触发注解处理器了，命令如下：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">javac -classpath AnnoJAr-<span class="number">1</span>.<span class="number">0</span>-SNAPSHOT.jar User.java</span><br></pre></td></tr></table></figure>
<p>如果是<code>maven</code>项目，则可以采用添加本地<code>Jar</code>依赖的方式（只要能够将<code>Jar</code>放入<code>classpath</code>就<code>ok</code>）</p>
<ol>
<li><p>新建另外一个项目，放入待编译的代码<img src="/2024/04/17/Java/Java%20Annotation/image-20240205145902523.png" alt="image-20240205145902523"></p>
</li>
<li><p>引入<code>Jar</code>依赖（本地依赖，把<code>Jar</code>包放在项目根本目录，然后写<code>Dependency</code>）<img src="/2024/04/17/Java/Java%20Annotation/image-20240205150215756.png" alt="image-20240205150215756"></p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20240205150247735.png" alt="image-20240205150247735"></p>
</li>
<li><p>现在点击<img src="/2024/04/17/Java/Java%20Annotation/image-20240205150325941.png" alt="image-20240205150325941">就可以看到注解处理编译了<img src="/2024/04/17/Java/Java%20Annotation/image-20240205150412867.png" alt="image-20240205150412867"></p>
</li>
<li>同时在<code>target</code>目录下会有我们生成的代码<img src="/2024/04/17/Java/Java%20Annotation/image-20240205150651903.png" alt="image-20240205150651903"></li>
</ol>
</li>
</ol>
<h5 id="基于Maven编译插件中注解处理器参数运行"><a href="#基于Maven编译插件中注解处理器参数运行" class="headerlink" title="基于Maven编译插件中注解处理器参数运行"></a>基于Maven编译插件中注解处理器参数运行</h5><p>这种方式和基于服务注册编译运行一致，区别在于如果编译出来的<code>Jar</code>没有带<code>SPI</code>文件，如：<img src="/2024/04/17/Java/Java%20Annotation/image-20240205151552597.png" alt="image-20240205151552597"></p>
<p>则您可以在<code>pom.xml</code>中指定编译插件的注解处理器参数来编译项目，参数如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">annotationProcessors</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!-- 核心是这里，改成注解处理器的全限定类名 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">annotationProcessor</span>&gt;</span></span><br><span class="line">                     cn.argento.askia.processors.source.ToStringAnnotationProcessor</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">annotationProcessor</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">annotationProcessors</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20240205151811017.png" alt="image-20240205151811017"></p>
<p>这样也可以运行注解处理器而无需在<code>META-INF/services</code>下编写<code>SPI</code>文件！</p>
<h4 id="CLASS级别注解处理"><a href="#CLASS级别注解处理" class="headerlink" title="CLASS级别注解处理"></a>CLASS级别注解处理</h4><p>// 待补充，暂时不会字节码插桩！笨比博主在学了在学了！😭😭</p>
<h3 id="注解源码结构"><a href="#注解源码结构" class="headerlink" title="注解源码结构"></a>注解源码结构</h3><p>所有的注解实际上都隐式地继承于<code>java.lang.annotation.Annotation</code><strong>接口</strong>，该接口是个<strong>常规接口</strong>，定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Annotation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object obj)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">// 获取注解的类型</span></span><br><span class="line">    Class&lt;? extends Annotation&gt; annotationType();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注解类型直接通过<code>getClass()</code>获得的<code>Class</code>对象不是注解类型本身，而是代理对象（注解的结构和动态代理有关），也就是注解接口的具体实现对象，想要获取真正的注解类型，必须使用<code>Annotation</code>接口提供给的<code>annotationType()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Test test = <span class="keyword">this</span>.getClass().getAnnotation(Test.class);</span><br><span class="line">System.out.println(test.annotationType());</span><br><span class="line">System.out.println(test.getClass());</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">输出：</span></span><br><span class="line"><span class="comment">interface Test</span></span><br><span class="line"><span class="comment">class com.sun.proxy.$Proxy1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><code>Annotation</code>接口的<code>String toString();</code>将会输入一个包含注解接口及其元素名称和默认值的字符串表示，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(test.toString());</span><br><span class="line"><span class="comment">// @Test(timeout=100)</span></span><br></pre></td></tr></table></figure>
<p>同样回到<code>BugReport</code>注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.METHOD, ElementType.TYPE, ElementType.ANNOTATION_TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> BugReport &#123;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> 2000</span>;</span><br><span class="line">    <span class="function">String <span class="title">versions</span><span class="params">()</span> <span class="keyword">default</span> &quot;1.1.0&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">version</span><span class="params">()</span> <span class="keyword">default</span> 1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">subVersion</span><span class="params">()</span> <span class="keyword">default</span> 1.0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">showStopper</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">assignedTo</span><span class="params">()</span> <span class="keyword">default</span> &quot;[none]&quot;</span>;</span><br><span class="line">    Class&lt;?&gt; testCase() <span class="keyword">default</span> Void.class;</span><br><span class="line">    <span class="function">Status <span class="title">status</span><span class="params">()</span> <span class="keyword">default</span> Status.CONFIRMED</span>;</span><br><span class="line">    <span class="function">Reference <span class="title">ref</span><span class="params">()</span> <span class="keyword">default</span> @Reference</span>;</span><br><span class="line">    String[] reportedBy() <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    Class&lt;?&gt;[] clazz() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">Status</span> </span>&#123;UNCONFIRMED, CONFIRMED, FIXED, NOTABUG&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@interface</span> Reference&#123;</span><br><span class="line">        <span class="function">String <span class="title">ref</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">        <span class="function">String <span class="title">url</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">B</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对注解进行反编译（使用<code>javap.exe</code>），获取到底层处理注解的方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 0.所有的@interface实际上都会被编译成interface XXX extends Annotation</span></span><br><span class="line"><span class="comment">// 1.继承自Annotation接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">cn</span>.<span class="title">argento</span>.<span class="title">askia</span>.<span class="title">annotation</span>.<span class="title">full</span>.<span class="title">BugReport</span> </span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">annotation</span>.<span class="title">Annotation</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 2.所有的数据成员都会被处理成方法</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">long</span> <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> java.lang.<span class="function">String <span class="title">versions</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">version</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">double</span> <span class="title">subVersion</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">showStopper</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> java.lang.<span class="function">String <span class="title">assignedTo</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> java.lang.Class&lt;?&gt; testCase();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> cn.argento.askia.annotation.full.<span class="function">BugReport$Status <span class="title">status</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> cn.argento.askia.annotation.full.<span class="function">BugReport$Reference <span class="title">ref</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> java.lang.String[] reportedBy();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">abstract</span> java.lang.Class&lt;?&gt;[] clazz();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>到此位置，我们知道定义注解的<code>@interface</code>和相关数据成员会被进行怎样的处理，但还有一个关键问题，注解中的数据成员的默认值是如何绑定到方法的呢？</p>
<p>既然注解技术依赖于动态代理，我们可以尝试将代理对象的源代码拿出来进行分析，在代码中，添加这个系统属性可以将代理类导出！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.getProperties().setProperty(<span class="string">&quot;sun.misc.ProxyGenerator.saveGeneratedFiles&quot;</span>, <span class="string">&quot;true&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>拿到这个代理类的源代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">package</span> com.sun.proxy;</span><br><span class="line"><span class="keyword">import</span> cn.argento.askia.annotation.full.BugReport;</span><br><span class="line"><span class="keyword">import</span> cn.argento.askia.annotation.full.BugReport.Reference;</span><br><span class="line"><span class="keyword">import</span> cn.argento.askia.annotation.full.BugReport.Status;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.UndeclaredThrowableException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> $<span class="title">Proxy2</span> <span class="keyword">extends</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">BugReport</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m6;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m12;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m8;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m14;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m5;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m11;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m10;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m7;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m9;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m13;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m4;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关键就在这个InvocationHandler对象中，因为所有的方法都是委托InvocationHandler对象来完成的</span></span><br><span class="line">    <span class="keyword">public</span> $Proxy2(InvocationHandler对象中 var1) <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">super</span>(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m1, <span class="keyword">new</span> Object[]&#123;var1&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var4);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Reference <span class="title">ref</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Reference)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m6, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Class <span class="title">testCase</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Class)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m12, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m2, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">showStopper</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m8, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Class <span class="title">annotationType</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Class)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m14, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Status <span class="title">status</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Status)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m5, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">assignedTo</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m11, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m0, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">versions</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m10, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">version</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m7, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">double</span> <span class="title">subVersion</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Double)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m9, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String[] reportedBy() <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String[])<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m13, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Class[] clazz() <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Class[])<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m3, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">long</span> <span class="title">value</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Long)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m4, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            m1 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;equals&quot;</span>, Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>));</span><br><span class="line">            m6 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;ref&quot;</span>);</span><br><span class="line">            m12 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;testCase&quot;</span>);</span><br><span class="line">            m2 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;toString&quot;</span>);</span><br><span class="line">            m8 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;showStopper&quot;</span>);</span><br><span class="line">            m14 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;annotationType&quot;</span>);</span><br><span class="line">            m5 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;status&quot;</span>);</span><br><span class="line">            m11 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;assignedTo&quot;</span>);</span><br><span class="line">            m0 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">            m10 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;versions&quot;</span>);</span><br><span class="line">            m7 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;version&quot;</span>);</span><br><span class="line">            m9 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;subVersion&quot;</span>);</span><br><span class="line">            m13 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;reportedBy&quot;</span>);</span><br><span class="line">            m3 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;clazz&quot;</span>);</span><br><span class="line">            m4 = Class.forName(<span class="string">&quot;cn.argento.askia.annotation.full.BugReport&quot;</span>).getMethod(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError(var2.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoClassDefFoundError(var3.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代理对象不出意外地实现了注解<code>BugReport</code>接口，动态代理的关键就在<code>InvocationHandler</code>对象中，代理对象的所有方法都是委托<code>InvocationHandler</code>对象来完成的！那传递给这个代理对象的<code>InvocationHandler</code>对象又是什么呢？</p>
<p>幸好，动态代理的<code>API</code>提供了获取<code>InvocationHandler</code>对象的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InvocationHandler <span class="title">getInvocationHandler</span><span class="params">(Object proxy)</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> IllegalArgumentException</span></span><br></pre></td></tr></table></figure>
<p>使用下面的代码获取具体的<code>InvocationHandler</code>对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> BugReport annotation = Myclass2.class.getAnnotation(BugReport.class);</span><br><span class="line"><span class="keyword">final</span> InvocationHandler invocationHandler = Proxy.getInvocationHandler(annotation);</span><br><span class="line">System.out.println(invocationHandler.getClass());</span><br></pre></td></tr></table></figure>
<p>得到结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sun</span>.<span class="title">reflect</span>.<span class="title">annotation</span>.<span class="title">AnnotationInvocationHandler</span></span></span><br></pre></td></tr></table></figure>
<p><code>AnnotationInvocationHandler</code>类中的主要核心如下：</p>
<p><img src="/2024/04/17/Java/Java%20Annotation/image-20230907195235350.png" alt="image-20230907195235350"></p>
<p>其中<code>memberValues</code>用于存放数据成员的值，<code>invoke()</code>方法对注解中的方法的调用进行拦截，然后返回值！</p>
<p>据此可以得到初步结论：</p>
<ul>
<li>注解采用接口中的方法来表示变量</li>
<li><code>Java</code>为注解创建一个代理类。这个代理类包括一个<code>AnnotationInvocationHandler</code>成员变量</li>
<li><code>AnnotationInvocationHandler</code>有一个<code>Map</code>成员变量，用于存储所有的注解的属性赋值！</li>
<li>在程序中，调用注解接口的方法，将会被代理类接管，然后根据方法名字，到<code>Map</code>里面拿相应的<code>Value</code>并返回。</li>
<li>传递给<code>AnnotationInvocationHandler</code>的用于初始化<code>Map</code>成员变量的各种注解方法的默认值被<code>AnnotationParser</code>类的<code>parseXXX()</code>解析获得</li>
</ul>
<blockquote>
<p>2024.1.22</p>
<p>虽然没有什么意义，但你仍然可以采用匿名类的形式直接new注解并且直接调用他的方法，这时注解属性的default将不起作用，相当于new接口！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Report&#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Report report = <span class="keyword">new</span> Report()&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;? extends Annotation&gt; annotationType() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">report.value();	<span class="comment">// null;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="可重复标记注解的实现"><a href="#可重复标记注解的实现" class="headerlink" title="可重复标记注解的实现"></a>可重复标记注解的实现</h4><p>如下面的类，他标记了可重复注解<code>@RepeatableAnnotation</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@BugReport(2)</span></span><br><span class="line"><span class="meta">@InheritedAnnotation</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bug</span></span>&#123;</span><br><span class="line">    <span class="meta">@BugReport(2)</span></span><br><span class="line">    <span class="meta">@RepeatableAnnotation(description = &quot;setBug method1&quot;)</span></span><br><span class="line">    <span class="meta">@RepeatableAnnotation(description = &quot;setBug method2&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Bug <span class="title">setBug</span><span class="params">(String bug)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.bug = bug;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过编译之后，它实际上会变成这样（<code>InheritedAnnotationContainer</code>是<code>InheritedAnnotation</code>的注解容器）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@BugReport(2)</span><br><span class="line">@InheritedAnnotation</span><br><span class="line">class Bug&#123;</span><br><span class="line">    @BugReport(2)</span><br><span class="line">    @InheritedAnnotationContainer(&#123;</span><br><span class="line">    	@RepeatableAnnotation(description = &quot;setBug method1&quot;),</span><br><span class="line">    	@RepeatableAnnotation(description = &quot;setBug method2&quot;)</span><br><span class="line">    &#125;)</span><br><span class="line">    public Bug setBug(String bug) &#123;</span><br><span class="line">        this.bug = bug;</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>没错，当可重复注解标记了一个的时候，则会只显示一个可重复注解，但是如果标记了多个的话则会使用注解容器！</p>
<p>使用反射获取注解时，特别注意<code>getAnnotationsByType()</code>方法是<code>JDK 1.8</code>才引入的，在<code>1.8</code>以前，只能通过获取可重复注解的注解容器的形式来获取。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Repeatable(RepeatableAnnotation.RepeatableAnnotations.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> RepeatableAnnotation &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">description</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Documented</span></span><br><span class="line">    <span class="meta">@Target(&#123;ElementType.FIELD, ElementType.CONSTRUCTOR, ElementType.METHOD&#125;)</span></span><br><span class="line">    <span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line">    <span class="meta">@interface</span> RepeatableAnnotations&#123;</span><br><span class="line">        RepeatableAnnotation[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 下面两个方式获取的结果相同</span></span><br><span class="line"><span class="comment">// 获取方式1（JDK 1.5版本）</span></span><br><span class="line"><span class="keyword">final</span> RepeatableAnnotation.RepeatableAnnotations annotation1 = setBug.getAnnotation(RepeatableAnnotation.RepeatableAnnotations.class);</span><br><span class="line"><span class="keyword">final</span> RepeatableAnnotation[] value = annotation1.value();</span><br><span class="line">System.out.println(Arrays.toString(value));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取方式2（JDK 1.8版本）</span></span><br><span class="line"><span class="keyword">final</span> RepeatableAnnotation[] annotationsByType = setBug.getAnnotationsByType(RepeatableAnnotation.class);</span><br><span class="line">System.out.println(Arrays.toString(annotationsByType));</span><br></pre></td></tr></table></figure>
<p>在标记可重复注解的时候，实际上最终被编译成字节码的时候标记在元素上的不是可重复注解而是注解容器，所以使用<code>isAnnotationPresent()</code>判断是否标记上可重复注解时，永远都返回<code>false</code>，<strong>除非你只标记了一个可重复注解！</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注意可重复注解的获取，标记的永远是注解容器</span></span><br><span class="line"><span class="comment">// false</span></span><br><span class="line">System.out.println(<span class="string">&quot;setBug方法上是否标记了RepeatableAnnotation注解=&quot;</span> + setBug.isAnnotationPresent(RepeatableAnnotation.class));</span><br><span class="line"><span class="comment">// true</span></span><br><span class="line">System.out.println(<span class="string">&quot;setBug方法上是否标记了RepeatableAnnotations注解容器=&quot;</span> + setBug.isAnnotationPresent(RepeatableAnnotation.RepeatableAnnotations.class));</span><br></pre></td></tr></table></figure>
<h3 id="注解应用框架"><a href="#注解应用框架" class="headerlink" title="注解应用框架"></a>注解应用框架</h3><h4 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h4><p><code>Lombok</code>是一个非常优秀的<code>java</code>类库，它利用注解方式自动生成<code>java bean</code>中<code>getter</code>、<code>setter</code>、<code>equals</code>等方法，还能自动生成 <code>logger</code>、<code>toString</code>、<code>hashCode</code>、<code>builder</code>等 日志相关变量。</p>
<p>在<code>Lombok</code>的使用中，核心的注解主要位于：</p>
<ul>
<li><code>lombok.*</code>（主包），该包下的注解都是功能稳定的注解，如常用的<code>@Setter</code>、<code>@Getter</code>、<code>@Data</code>等</li>
<li><code>lombok.experimental.*</code>（实验包）该包下的注解都是带实验性质的（不稳定），一些测试注解或者从主包被废弃的注解会被移动到这里</li>
<li><code>lombok.extern.*</code>（扩展包）该包下的注解针对其他第三方库（主要是日志），如<code>slf4j</code>、<code>log4j</code>、<code>commonLog</code>等</li>
</ul>
<h5 id="主包注解"><a href="#主包注解" class="headerlink" title="主包注解"></a>主包注解</h5><ul>
<li><p>用于生成实体类的<code>@Data</code>、<code>@AllArgsConstructor</code>、<code>@EqualsAndHashCode</code>、<code>@Getter</code>、<code>@Setter</code>、<code>@NoArgsConstructor</code>、<code>@RequiredArgsConstructor</code>、<code>@ToString</code></p>
</li>
<li><p>用于实体类扩展的<code>@Value</code>、<code>@With</code></p>
</li>
<li><p>用于创建实体的<code>Builder</code>类的<code>@Builder</code>、<code>@Singular</code></p>
</li>
<li><p>用于<code>IO</code>流自动关闭的<code>@Cleanup</code></p>
</li>
<li>用于自定义日志的<code>@CustomLog</code>（该注解我们连同扩展包一起讲！）</li>
<li>用于判空的<code>@NonNull</code></li>
<li>用于异常的<code>@SneakyThrows</code></li>
<li>用于锁的<code>@Synchronized</code></li>
<li>匿名局部变量特性：<code>val</code>、<code>var</code></li>
</ul>
<h6 id="val-amp-amp-var"><a href="#val-amp-amp-var" class="headerlink" title="val&amp;&amp;var"></a>val&amp;&amp;var</h6><p>首先<code>lombok</code>中支持你在局部变量里面使用<code>val</code>和<code>var</code>来代替具体的类型，<code>val</code>会生成<code>final</code>的局部变量</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">    <span class="comment">// lombok会生成 ArrayList&lt;String&gt; a = new ArrayList&lt;String&gt;();</span></span><br><span class="line">    val b = <span class="keyword">new</span> User();</span><br><span class="line">    <span class="comment">// lombok会生成 final User b = new User();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Data及相关的注解"><a href="#Data及相关的注解" class="headerlink" title="@Data及相关的注解"></a>@Data及相关的注解</h6><p>对于实体类，使用<code>@Data</code>注解将会为：</p>
<ul>
<li>默认构造器（空构造器，如果有<code>final</code>字段或者字段被标记了<code>@NonNull</code>，则为这些字段生成一个构造器）</li>
<li>为所有非<code>final</code>字段生成<code>Setter</code></li>
<li>为所有字段生成<code>Getter</code></li>
<li>生成<code>equals()</code>和<code>hashCode()</code></li>
<li>生成一个以逗号分割成员，括号作为左右链接符的<code>toString()</code></li>
</ul>
<p><code>@Data</code>中有一个数据成员:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">String <span class="title">staticConstructor</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span></span><br></pre></td></tr></table></figure>
<p>如果指定了数据成员，则使用工厂的方式来初始化实体类，会将构造器定义为<code>private</code>，然后生成一个<code>public static</code> 的工厂方法，工厂方法名就是<code>staticConstructor()</code>的值！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data(staticConstructor = &quot;newInstance&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticUser</span></span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将生成</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticUser</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">StaticUser</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StaticUser <span class="title">newInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StaticUser();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于默认情况下<code>@Data</code>注解只会生成默认构造器或者为<code>final</code>成员生成构造器。在<code>lombok</code>中，有三个和构造器生成有关的注解：</p>
<ul>
<li><code>@AllArgsConstructor</code>：生成全参构造器</li>
<li><code>@NoArgsConstructor</code>：生成无参构造器</li>
<li><code>@RequiredArgsConstructor</code>：和<code>@Data</code>注解的构造器生成一样，专门生成<code>final</code>字段和<code>@NonNull</code>字段的构造器</li>
</ul>
<p>注意当标记了<code>@Data</code>和<code>@AllArgsConstructor</code>的时候，<code>@AllArgsConstructor</code>会覆盖掉<code>@Data</code>的默认构造器，使类只有一个<code>AllArgs</code>的构造器，因此如果希望实体类既有无参构造器，又有全参构造器，则需要将<code>@AllArgsConstructor</code>和<code>@NoArgsConstructor</code>都标记上！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticUser</span></span>&#123;</span><br><span class="line">    <span class="comment">// 这样实体类里面就会有无参构造、全参构造、Setter、Getter、ToString、hashCode</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果希望生成无参构造、全参构造和部分参数构造，则可以这三个注解配合来使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; cards;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 将生成</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, <span class="keyword">int</span> id)</span></span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(String name, <span class="keyword">int</span> id, inta age, List&lt;String&gt; cards)</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>这三个构造器注解中，有两个比较重要的数据属性：</p>
<ul>
<li><code>staticName()</code>：和<code>@Data</code>的<code>staticConstructor()</code>作用相同</li>
<li><code>access()</code>：代表访问级别，如<code>public</code>、<code>private</code>等</li>
</ul>
<p>除了使用<code>@Data</code>之外，还可以使用<code>@Getter</code>和<code>@Setter</code>为其添加响应字段的<code>Setter</code>和<code>Getter</code>方，<code>@Getter</code>和<code>@Setter</code>的<code>value</code>属性可以指定方法的访问级别。</p>
<p><code>@Getter</code>和<code>@Setter</code>也可以标记在单个字段上，这样则只会为该字段生成<code>Getter</code>和<code>Setter</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">	<span class="meta">@Setter(&quot;lombok.AccessLevel.protected&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; cards;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以单独使用<code>@ToString</code>来为实体类生成<code>toString()</code>，<code>@ToString</code>中，你可以使用下面属性：</p>
<ul>
<li><code>boolean includeFieldNames()</code>：输出的<code>toString()</code>中是否包含字段名称，默认是<code>true</code></li>
<li><code>boolean callSuper()</code>：子类的<code>toString</code>是否调用<code>super.toString()</code>来打印父类的字段，默认是<code>false</code></li>
<li><code>boolean doNotUseGetters() default false;</code>：是否不使用<code>getter</code>方法来获取值，一般情况下<code>@ToString</code>生成的<code>toString()</code>是调用<code>getter</code>来获取值的，设置为<code>true</code>则直接使用字段而非<code>Getter</code></li>
</ul>
<p>另外还有两个数据成员：<code>exclude()</code>和<code>of()</code>，他们分别代表打印<code>toString</code>时需要排除掉的字段和需要打印的字段，这两个数据成员将会被<code>@ToString.Exclude</code>注解和<code>@ToString.Include</code>注解替代。</p>
<p>当前<code>Lombok</code>中，<code>@ToString</code>默认情况下会自动输出全部字段的<code>toString()</code>，只有设置了<code>boolean onlyExplicitlyIncluded()</code>为<code>true</code>，这样他就只会输出标记了<code>@ToString.Include</code>的字段。</p>
<p><code>@EqualsAndHashCode</code>注解数据成员和<code>@ToString</code>相同！</p>
<h6 id="Builder和-Singular"><a href="#Builder和-Singular" class="headerlink" title="@Builder和@Singular"></a>@Builder和@Singular</h6><p><code>@Builder</code>注解用于为一个实体类生成一个<code>Builder</code>类，如果实体类中有<code>List</code>、<code>Set</code>等集合类型，则额外添加清空所有成员的<code>clearXX()</code>方法，并且可以配合</p>
<p><code>@Singular</code>使用为这些集合类型生成一个添加单个成员的<code>add()</code>，该<code>add()</code>方法名由<code>@Singular</code>的<code>value</code>数据成员控制</p>
<p><code>@Builder</code>注解生成如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Before: </span></span><br><span class="line"> <span class="meta">@Builder</span></span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">Example</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">   	<span class="keyword">private</span> T foo;</span><br><span class="line">   	<span class="keyword">private</span> <span class="keyword">final</span> String bar;</span><br><span class="line">    <span class="meta">@Singular(&quot;addCard&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; cards;   </span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line"><span class="comment">// After:</span></span><br><span class="line">   <span class="class"><span class="keyword">class</span> <span class="title">Example</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">   	<span class="keyword">private</span> T foo;</span><br><span class="line">   	<span class="keyword">private</span> <span class="keyword">final</span> String bar;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; cards;  </span><br><span class="line">   	</span><br><span class="line">   	<span class="function"><span class="keyword">private</span> <span class="title">Example</span><span class="params">(T foo, String bar, List&lt;String&gt; cards)</span> </span>&#123;</span><br><span class="line">   		<span class="keyword">this</span>.foo = foo;</span><br><span class="line">   		<span class="keyword">this</span>.bar = bar;</span><br><span class="line">        <span class="keyword">this</span>.cards = cards;</span><br><span class="line">   	&#125;</span><br><span class="line">   	<span class="comment">// 生成一个静态的builder()方法，方法名有数据成员String builderMethodName()控制</span></span><br><span class="line">   	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">ExampleBuilder&lt;T&gt; <span class="title">builder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   		<span class="keyword">return</span> <span class="keyword">new</span> ExampleBuilder&lt;T&gt;();</span><br><span class="line">   	&#125;</span><br><span class="line">   	<span class="comment">// 生成一个Builder类，该类的类名由String builderClassName()控制</span></span><br><span class="line">   	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleBuilder</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">   		<span class="keyword">private</span> T foo;</span><br><span class="line">   		<span class="keyword">private</span> String bar;</span><br><span class="line">        <span class="keyword">private</span> List&lt;String&gt; cards;  </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//  @Singular添加单个成员的方法，方法名时注解的value值</span></span><br><span class="line">         <span class="keyword">public</span> User2.<span class="function">User2Builder <span class="title">addCard</span><span class="params">(String addCard)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.cards == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.cards = <span class="keyword">new</span> ArrayList();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">this</span>.cards.add(addCard);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> User2.<span class="function">User2Builder <span class="title">cards</span><span class="params">(Collection&lt;? extends String&gt; cards)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (cards == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;cards cannot be null&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.cards == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">this</span>.cards = <span class="keyword">new</span> ArrayList();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">this</span>.cards.addAll(cards);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 集合类型添加清空所有成员的方法</span></span><br><span class="line">        <span class="keyword">public</span> User2.<span class="function">User2Builder <span class="title">clearCards</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.cards != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">this</span>.cards.clear();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">   		</span><br><span class="line">   		<span class="function"><span class="keyword">private</span> <span class="title">ExampleBuilder</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">   		</span><br><span class="line">   		<span class="function"><span class="keyword">public</span> ExampleBuilder <span class="title">foo</span><span class="params">(T foo)</span> </span>&#123;</span><br><span class="line">   			<span class="keyword">this</span>.foo = foo;</span><br><span class="line">   			<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   		&#125;</span><br><span class="line">   		</span><br><span class="line">   		<span class="function"><span class="keyword">public</span> ExampleBuilder <span class="title">bar</span><span class="params">(String bar)</span> </span>&#123;</span><br><span class="line">   			<span class="keyword">this</span>.bar = bar;</span><br><span class="line">   			<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">   		&#125;</span><br><span class="line">   		</span><br><span class="line">   		<span class="meta">@java</span>.lang.<span class="function">Override <span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   			<span class="keyword">return</span> <span class="string">&quot;ExampleBuilder(foo = &quot;</span> + foo + <span class="string">&quot;, bar = &quot;</span> + bar + <span class="string">&quot;, cards = &quot;</span> + <span class="keyword">this</span>.cards + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">   		&#125;</span><br><span class="line">   		<span class="comment">// build()方法，该方法方法名由数据成员String buildMethodName()控制</span></span><br><span class="line">   		<span class="function"><span class="keyword">public</span> Example <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   			<span class="keyword">return</span> <span class="keyword">new</span> Example(foo, bar, cards);</span><br><span class="line">   		&#125;</span><br><span class="line">   	&#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h6 id="Cleanup"><a href="#Cleanup" class="headerlink" title="@Cleanup"></a>@Cleanup</h6><p><code>@Cleanup</code>将用于自动关闭<code>IO</code>流，注意他将会包裹整个方法的所有代码！该注解接收一个数据成员，用于指定关闭外部资源的方法的名称！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">copyFile</span><span class="params">(String in, String out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">     <span class="meta">@Cleanup</span> FileInputStream inStream = <span class="keyword">new</span> FileInputStream(in);</span><br><span class="line">     <span class="meta">@Cleanup</span> FileOutputStream outStream = <span class="keyword">new</span> FileOutputStream(out);</span><br><span class="line">     <span class="comment">// 下面的所有代码都将会被try...catch... 包裹</span></span><br><span class="line">     <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">65536</span>];</span><br><span class="line">     <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">         <span class="keyword">int</span> r = inStream.read(b);</span><br><span class="line">         <span class="keyword">if</span> (r == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">         outStream.write(b, <span class="number">0</span>, r);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 会生成：</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">copyFile</span><span class="params">(String in, String out)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">     <span class="meta">@Cleanup</span> FileInputStream inStream = <span class="keyword">new</span> FileInputStream(in);</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="meta">@Cleanup</span> FileOutputStream outStream = <span class="keyword">new</span> FileOutputStream(out);</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">             <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">65536</span>];</span><br><span class="line">             <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">                 <span class="keyword">int</span> r = inStream.read(b);</span><br><span class="line">                 <span class="keyword">if</span> (r == -<span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">                 outStream.write(b, <span class="number">0</span>, r);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">             <span class="keyword">if</span> (outStream != <span class="keyword">null</span>) outStream.close();</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (inStream != <span class="keyword">null</span>) inStream.close();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h6 id="NonNull"><a href="#NonNull" class="headerlink" title="@NonNull"></a>@NonNull</h6><p><code>@NonNull</code>可以标记在字段、参数上，标记在字段上，则会在判断是否字段为<code>null</code>的基础上，在构造器添加该字段的初始化！注意如果构造方法中有<code>this()</code>和<code>super()</code>则会在这行代码之后添加<code>null</code>检查</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.argento.askia.apps.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"><span class="keyword">import</span> lombok.RequiredArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NonNullExample</span> <span class="keyword">extends</span> <span class="title">Object</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NonNullExample</span><span class="params">(<span class="meta">@NonNull</span> String person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.name = person;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成：</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> cn.argento.askia.apps.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NonNullExample</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NonNullExample</span><span class="params">(<span class="meta">@NonNull</span> String person)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (person == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;person is marked non-null but is null&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.name = person;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NonNullExample</span><span class="params">(<span class="meta">@NonNull</span> Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (id == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;id is marked non-null but is null&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.id = id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="SneakyThrows"><a href="#SneakyThrows" class="headerlink" title="@SneakyThrows"></a>@SneakyThrows</h6><p><code>@SneakyThrows</code>用于再抛出异常，数据成员<code>value</code>指定再抛出的类型，生成的代码会调用<code>Lombok</code>类的下面两个方法抛出异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RuntimeException <span class="title">sneakyThrow</span><span class="params">(Throwable t)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (t == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;t&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> Lombok.&lt;RuntimeException&gt;sneakyThrow0(t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T extends Throwable&gt; <span class="function">T <span class="title">sneakyThrow0</span><span class="params">(Throwable t)</span> <span class="keyword">throws</span> T </span>&#123;</span><br><span class="line">   <span class="keyword">throw</span> (T)t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SneakyThrowsExample</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="meta">@SneakyThrows(UnsupportedEncodingException.class)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">utf8ToString</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> String(bytes, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> Throwable();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SneakyThrowsExample</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">utf8ToString</span><span class="params">(<span class="keyword">byte</span>[] bytes)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> String(bytes, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">      <span class="keyword">throw</span> Lombok.sneakyThrow(e);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> Throwable();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">      <span class="comment">// !!  </span></span><br><span class="line">      <span class="keyword">throw</span> Lombok.sneakyThrow(t);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Synchronized"><a href="#Synchronized" class="headerlink" title="@Synchronized"></a>@Synchronized</h6><p><code>@Synchronized</code>作用于方法，代表方法是同步的！使用<code>value</code>数据成员指定锁！（指定锁的时候，锁一定要已经存在！）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Object readLock = <span class="keyword">new</span> Object();</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Synchronized</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Synchronized</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">answerToLife</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Synchronized(&quot;readLock&quot;)</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynchronizedExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object $LOCK = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Object $lock = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Object readLock = <span class="keyword">new</span> Object();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>($LOCK) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">answerToLife</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>($lock) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">42</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(readLock) &#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h6><p><code>@Value</code>和<code>@Data</code>很像，但<code>@Value</code>不会生成<code>Setter</code>方法，并且类和字段都会被设置成<code>final</code>形式，数据成员<code>staticConstructor()</code>和<code>@AllArgsConstructor</code>等的相同，可以指定<code>@NonFinal</code>注解来改变是否需要加<code>final</code>关键字：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.NonFinal;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.Value;</span><br><span class="line"><span class="keyword">import</span> lombok.experimental.With;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Value</span> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueExample</span> </span>&#123;</span><br><span class="line">  String name;</span><br><span class="line">  <span class="meta">@With(AccessLevel.PACKAGE)</span> <span class="meta">@NonFinal</span> <span class="keyword">int</span> age;</span><br><span class="line">  <span class="keyword">double</span> score;</span><br><span class="line">  <span class="keyword">protected</span> String[] tags;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ToString(includeFieldNames=true)</span></span><br><span class="line">  <span class="meta">@Value(staticConstructor=&quot;of&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    T value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> score;</span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">final</span> String[] tags;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@java</span>.beans.ConstructorProperties(&#123;<span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;score&quot;</span>, <span class="string">&quot;tags&quot;</span>&#125;)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ValueExample</span><span class="params">(String name, <span class="keyword">int</span> age, <span class="keyword">double</span> score, String[] tags)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.score = score;</span><br><span class="line">    <span class="keyword">this</span>.tags = tags;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.age;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.score;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String[] getTags() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.tags;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@java</span>.lang.<span class="function">Override</span></span><br><span class="line"><span class="function">  <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">this</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> ValueExample)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">final</span> ValueExample other = (ValueExample)o;</span><br><span class="line">    <span class="keyword">final</span> Object <span class="keyword">this</span>$name = <span class="keyword">this</span>.getName();</span><br><span class="line">    <span class="keyword">final</span> Object other$name = other.getName();</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>$name == <span class="keyword">null</span> ? other$name != <span class="keyword">null</span> : !<span class="keyword">this</span>$name.equals(other$name)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.getAge() != other.getAge()) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (Double.compare(<span class="keyword">this</span>.getScore(), other.getScore()) != <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (!Arrays.deepEquals(<span class="keyword">this</span>.getTags(), other.getTags())) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@java</span>.lang.<span class="function">Override</span></span><br><span class="line"><span class="function">  <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> PRIME = <span class="number">59</span>;</span><br><span class="line">    <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">final</span> Object $name = <span class="keyword">this</span>.getName();</span><br><span class="line">    result = result * PRIME + ($name == <span class="keyword">null</span> ? <span class="number">43</span> : $name.hashCode());</span><br><span class="line">    result = result * PRIME + <span class="keyword">this</span>.getAge();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">long</span> $score = Double.doubleToLongBits(<span class="keyword">this</span>.getScore());</span><br><span class="line">    result = result * PRIME + (<span class="keyword">int</span>)($score &gt;&gt;&gt; <span class="number">32</span> ^ $score);</span><br><span class="line">    result = result * PRIME + Arrays.deepHashCode(<span class="keyword">this</span>.getTags());</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@java</span>.lang.<span class="function">Override</span></span><br><span class="line"><span class="function">  <span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ValueExample(name=&quot;</span> + getName() + <span class="string">&quot;, age=&quot;</span> + getAge() + <span class="string">&quot;, score=&quot;</span> + getScore() + <span class="string">&quot;, tags=&quot;</span> + Arrays.deepToString(getTags()) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function">ValueExample <span class="title">withAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.age == age ? <span class="keyword">this</span> : <span class="keyword">new</span> ValueExample(name, age, score, tags);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Exercise</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T value;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Exercise</span><span class="params">(String name, T value)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.name = name;</span><br><span class="line">      <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Exercise&lt;T&gt; <span class="title">of</span><span class="params">(String name, T value)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Exercise&lt;T&gt;(name, value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@java</span>.lang.<span class="function">Override</span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (o == <span class="keyword">this</span>) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> ValueExample.Exercise)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">final</span> Exercise&lt;?&gt; other = (Exercise&lt;?&gt;)o;</span><br><span class="line">      <span class="keyword">final</span> Object <span class="keyword">this</span>$name = <span class="keyword">this</span>.getName();</span><br><span class="line">      <span class="keyword">final</span> Object other$name = other.getName();</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>$name == <span class="keyword">null</span> ? other$name != <span class="keyword">null</span> : !<span class="keyword">this</span>$name.equals(other$name)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">final</span> Object <span class="keyword">this</span>$value = <span class="keyword">this</span>.getValue();</span><br><span class="line">      <span class="keyword">final</span> Object other$value = other.getValue();</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>$value == <span class="keyword">null</span> ? other$value != <span class="keyword">null</span> : !<span class="keyword">this</span>$value.equals(other$value)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@java</span>.lang.<span class="function">Override</span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> PRIME = <span class="number">59</span>;</span><br><span class="line">      <span class="keyword">int</span> result = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">final</span> Object $name = <span class="keyword">this</span>.getName();</span><br><span class="line">      result = result * PRIME + ($name == <span class="keyword">null</span> ? <span class="number">43</span> : $name.hashCode());</span><br><span class="line">      <span class="keyword">final</span> Object $value = <span class="keyword">this</span>.getValue();</span><br><span class="line">      result = result * PRIME + ($value == <span class="keyword">null</span> ? <span class="number">43</span> : $value.hashCode());</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@java</span>.lang.<span class="function">Override</span></span><br><span class="line"><span class="function">    <span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;ValueExample.Exercise(name=&quot;</span> + getName() + <span class="string">&quot;, value=&quot;</span> + getValue() + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="With"><a href="#With" class="headerlink" title="@With"></a>@With</h6><p><code>@With</code>注解用来实现给类字段生成一个<code>withXXX</code>(<code>XXX</code>为字段名)的方法，其内部方法代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> WithExample <span class="title">withAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.age == age ? <span class="keyword">this</span> : <span class="keyword">new</span> WithExample(name, age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@With</code>可以标记在类和字段上,标记在类上，则为类的所有字段生成<code>withXXX()</code>，标记在字段上则单独生成<code>withXXX()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.FIELD, ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> With &#123;</span><br><span class="line">	<span class="comment">// 用来设置访问级别</span></span><br><span class="line">	<span class="function">AccessLevel <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> AccessLevel.PUBLIC</span>;</span><br><span class="line">	AnyAnnotation[] onMethod() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">	AnyAnnotation[] onParam() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.AccessLevel;</span><br><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"><span class="keyword">import</span> lombok.With;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WithExample</span> </span>&#123;</span><br><span class="line">  <span class="meta">@With(AccessLevel.PROTECTED)</span> <span class="meta">@NonNull</span> <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line">  <span class="meta">@With</span> <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> age;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">WithExample</span><span class="params">(<span class="meta">@NonNull</span> String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WithExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="meta">@NonNull</span> <span class="keyword">final</span> String name;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">WithExample</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> WithExample <span class="title">withName</span><span class="params">(<span class="meta">@NonNull</span> String name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> java.lang.NullPointerException(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name == name ? <span class="keyword">this</span> : <span class="keyword">new</span> WithExample(name, age);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> WithExample <span class="title">withAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.age == age ? <span class="keyword">this</span> : <span class="keyword">new</span> WithExample(name, age);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="扩展包注解（日志）"><a href="#扩展包注解（日志）" class="headerlink" title="扩展包注解（日志）"></a>扩展包注解（日志）</h5><p>扩展包中的注解主要用来生成日志<code>Logger</code>对象，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(LogExample.class);</span><br></pre></td></tr></table></figure>
<p>相关的注解主要有及其生成的<code>Logger</code>对象：</p>
<ul>
<li><p><code>Apache Commons Log</code>：<code>@CommonsLog</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.apache.commons.logging.Log log = org.apache.commons.logging.LogFactory.getLog(LogExample.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Flogger</code>：<code>@Flogger</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> com.google.common.flogger.FluentLogger log = com.google.common.flogger.FluentLogger.forEnclosingClass();</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>JDK Log</code>：<code>@Log</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.util.logging.Logger log = java.util.logging.Logger.getLogger(LogExample.class.getName());</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>JBoss Log</code>：<code>@JBossLog</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.jboss.logging.Logger log = org.jboss.logging.Logger.getLogger(LogExample.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Log4j</code>：<code>@Log4j</code>、<code>@Log4j2</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.apache.log4j.Logger log = org.apache.log4j.Logger.getLogger(LogExample.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.apache.logging.log4j.Logger log = org.apache.logging.log4j.LogManager.getLogger(LogExample.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>Slf4J</code>：<code>@Slf4j</code>、<code>@XSlf4j</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.slf4j.Logger log = org.slf4j.LoggerFactory.getLogger(LogExample.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> org.slf4j.ext.XLogger log = org.slf4j.ext.XLoggerFactory.getXLogger(LogExample.class);</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>CustomLog</code>：<code>@CustomLog</code></p>
</li>
</ul>
<p>使用方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Log</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogExample</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">  	<span class="comment">// 这个log对象直接使用即可，lombok会生成！</span></span><br><span class="line">    log.severe(<span class="string">&quot;Something&#x27;s wrong here&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将会生成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogExample</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.util.logging.Logger log = java.util.logging.Logger.getLogger(LogExample.class.getName());</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">    log.severe(<span class="string">&quot;Something&#x27;s wrong here&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="实验包注解"><a href="#实验包注解" class="headerlink" title="实验包注解"></a>实验包注解</h5><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39249094/article/details/107313582">https://blog.csdn.net/qq_39249094/article/details/107313582</a></li>
</ul>
<h4 id="Jcommander"><a href="#Jcommander" class="headerlink" title="Jcommander"></a>Jcommander</h4><p><a target="_blank" rel="noopener" href="http://jcommander.org/#_overview">http://jcommander.org/#_overview</a></p>
<p>// 带补充…</p>
<h2 id="引用文章参考"><a href="#引用文章参考" class="headerlink" title="引用文章参考"></a>引用文章参考</h2><ul>
<li><code>《core java 11》</code></li>
<li><code>document JDK 8</code></li>
<li>华东师范大学慕课<code>Java</code>核心技术</li>
<li><code>CSDN</code>文章<ul>
<li>语言级别<code>API</code>：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/wellcherish/p/17147811.html">https://www.cnblogs.com/wellcherish/p/17147811.html</a></li>
<li>源码级别注解处理器：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zjcsuct/article/details/125285983">https://blog.csdn.net/zjcsuct/article/details/125285983</a></li>
</ul>
</li>
<li><code>Lombok</code>：<ul>
<li>官方文档</li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39249094/article/details/107313582">https://blog.csdn.net/qq_39249094/article/details/107313582</a></li>
</ul>
</li>
</ul>
<h2 id="JDK-11"><a href="#JDK-11" class="headerlink" title="JDK 11"></a>JDK 11</h2><h3 id="Deprecated"><a href="#Deprecated" class="headerlink" title="@Deprecated"></a>@Deprecated</h3><p><code>JDK 11</code>时，该注解添加了两个数据成员：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(value=&#123;CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, MODULE, PARAMETER, TYPE&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Deprecated &#123;</span><br><span class="line">    <span class="function">String <span class="title">since</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;				<span class="comment">// 从哪个版本开始废弃</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">forRemoval</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;		<span class="comment">// 是否后期移除</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/core-java/" rel="tag"># core java</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/05/21/%E5%8D%9A%E5%AE%A2%E8%BF%90%E7%BB%B4/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1hexo%E4%B8%8A%E4%BC%A0%E5%A4%A7%E6%96%87%E4%BB%B6%E5%A4%B1%E8%B4%A5%E4%BA%A7%E7%94%9F%E7%9A%84%E9%97%AE%E9%A2%98/" rel="prev" title="记录一次hexo上传大文件失败产生的问题">
                  <i class="fa fa-chevron-left"></i> 记录一次hexo上传大文件失败产生的问题
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/10/04/Windows/%E8%A7%A3%E5%86%B3Windows%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E5%88%97%E8%A1%A8%E5%B1%95%E5%BC%80/" rel="next" title="解决Windows环境变量无法使用列表展开">
                  解决Windows环境变量无法使用列表展开 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="SOHUCS" sid="2585bb142a5ec6493bdc16c1463c52a1"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Askia</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cyxyiBqK8","appkey":"b41fd3ec6c28772b8afe9ce1613b783a","count":true}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
